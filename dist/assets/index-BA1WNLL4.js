import{r as o,a as Ut,u as rt,b as _t,L as Pe,B as Ot,d as Ht,e as Ce,N as Ct}from"./react-vendor-dskLBWkL.js";import{c as Gt}from"./supabase-CQnWzhEg.js";import{L as it,M as St,T as wt,u as Yt,a as Jt,b as lt,P as bt,c as Zt}from"./leaflet-BTAmh134.js";(function(){const E=document.createElement("link").relList;if(E&&E.supports&&E.supports("modulepreload"))return;for(const N of document.querySelectorAll('link[rel="modulepreload"]'))R(N);new MutationObserver(N=>{for(const D of N)if(D.type==="childList")for(const w of D.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&R(w)}).observe(document,{childList:!0,subtree:!0});function B(N){const D={};return N.integrity&&(D.integrity=N.integrity),N.referrerPolicy&&(D.referrerPolicy=N.referrerPolicy),N.crossOrigin==="use-credentials"?D.credentials="include":N.crossOrigin==="anonymous"?D.credentials="omit":D.credentials="same-origin",D}function R(N){if(N.ep)return;N.ep=!0;const D=B(N);fetch(N.href,D)}})();var kt={exports:{}},nt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xt=o,Kt=Symbol.for("react.element"),Qt=Symbol.for("react.fragment"),er=Object.prototype.hasOwnProperty,tr=Xt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rr={key:!0,ref:!0,__self:!0,__source:!0};function Nt(_,E,B){var R,N={},D=null,w=null;B!==void 0&&(D=""+B),E.key!==void 0&&(D=""+E.key),E.ref!==void 0&&(w=E.ref);for(R in E)er.call(E,R)&&!rr.hasOwnProperty(R)&&(N[R]=E[R]);if(_&&_.defaultProps)for(R in E=_.defaultProps,E)N[R]===void 0&&(N[R]=E[R]);return{$$typeof:Kt,type:_,key:D,ref:w,props:N,_owner:tr.current}}nt.Fragment=Qt;nt.jsx=Nt;nt.jsxs=Nt;kt.exports=nt;var e=kt.exports,dt={},jt=Ut;dt.createRoot=jt.createRoot,dt.hydrateRoot=jt.hydrateRoot;const or="https://wcsnupcawrehmoldzfbm.supabase.co",ar="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indjc251cGNhd3JlaG1vbGR6ZmJtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNzU5MzcsImV4cCI6MjA4NTY1MTkzN30.lu_Qrh7thXsK6tv1Du9L8-oKAbFlh0IzMAROEUosjac",c=Gt(or,ar),zt=o.createContext(void 0);function ir({children:_}){const[E,B]=o.useState(null),[R,N]=o.useState(null),[D,w]=o.useState(!0);o.useEffect(()=>{c.auth.getSession().then(({data:{session:I}})=>{N(I),B((I==null?void 0:I.user)??null)}).catch(I=>{console.error("Error getting session:",I)}).finally(()=>{w(!1)});const{data:{subscription:y}}=c.auth.onAuthStateChange((I,A)=>{N(A),B((A==null?void 0:A.user)??null)});return()=>y==null?void 0:y.unsubscribe()},[]);const G=async(y,I)=>{const{error:A}=await c.auth.signUp({email:y,password:I});if(A)throw A},X=async(y,I)=>{const{error:A}=await c.auth.signInWithPassword({email:y,password:I});if(A)throw A},M=async()=>{const{error:y}=await c.auth.signOut();if(y)throw y};return e.jsx(zt.Provider,{value:{user:E,session:R,loading:D,signUp:G,signIn:X,signOut:M},children:_})}function ut(){const _=o.useContext(zt);if(_===void 0)throw new Error("useAuth must be used within AuthProvider");return _}function nr(){const[_,E]=o.useState(""),[B,R]=o.useState(""),[N,D]=o.useState(!1),[w,G]=o.useState(!1),[X,M]=o.useState(""),{signIn:y,signUp:I}=ut(),A=rt(),q=async u=>{u.preventDefault(),M(""),G(!0);try{N?(await I(_,B),alert("Cuenta creada exitosamente!")):await y(_,B),A("/dashboard")}catch(k){M(k.message||"Error al autenticar")}finally{G(!1)}};return e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0,0,0,0.1)",padding:"40px",width:"100%",maxWidth:"400px"},children:[e.jsx("h1",{style:{fontSize:"28px",fontWeight:"700",color:"#1f2937",marginBottom:"8px",textAlign:"center"},children:"Gestión de Tejidos"}),e.jsx("p",{style:{color:"#6b7280",textAlign:"center",marginBottom:"32px"},children:N?"Crear cuenta nueva":"Iniciar sesión"}),X&&e.jsx("div",{style:{background:"#fee2e2",border:"1px solid #ef4444",color:"#991b1b",padding:"12px",borderRadius:"6px",marginBottom:"20px",fontSize:"14px"},children:X}),e.jsxs("form",{onSubmit:q,children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:_,onChange:u=>E(u.target.value),required:!0,style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",outline:"none"},onFocus:u=>u.target.style.borderColor="#667eea",onBlur:u=>u.target.style.borderColor="#d1d5db"})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Contraseña"}),e.jsx("input",{type:"password",id:"password",name:"password",value:B,onChange:u=>R(u.target.value),required:!0,minLength:6,style:{width:"100%",padding:"12px",border:"1px solid #d1d5db",borderRadius:"6px",fontSize:"14px",outline:"none"},onFocus:u=>u.target.style.borderColor="#667eea",onBlur:u=>u.target.style.borderColor="#d1d5db"})]}),e.jsx("button",{type:"submit",disabled:w,style:{width:"100%",padding:"12px",background:w?"#9ca3af":"#667eea",color:"white",border:"none",borderRadius:"6px",fontSize:"16px",fontWeight:"600",marginBottom:"16px",transition:"background 0.2s"},onMouseEnter:u=>{w||(u.currentTarget.style.background="#5568d3")},onMouseLeave:u=>{w||(u.currentTarget.style.background="#667eea")},children:w?"Procesando...":N?"Crear Cuenta":"Iniciar Sesión"}),e.jsx("button",{type:"button",onClick:()=>{D(!N),M("")},style:{width:"100%",padding:"12px",background:"transparent",color:"#667eea",border:"1px solid #667eea",borderRadius:"6px",fontSize:"14px",fontWeight:"600"},children:N?"¿Ya tienes cuenta? Inicia sesión":"¿No tienes cuenta? Regístrate"})]})]})})}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sr={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lr=_=>_.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),ne=(_,E)=>{const B=o.forwardRef(({color:R="currentColor",size:N=24,strokeWidth:D=2,absoluteStrokeWidth:w,className:G="",children:X,...M},y)=>o.createElement("svg",{ref:y,...sr,width:N,height:N,stroke:R,strokeWidth:w?Number(D)*24/Number(N):D,className:["lucide",`lucide-${lr(_)}`,G].join(" "),...M},[...E.map(([I,A])=>o.createElement(I,A)),...Array.isArray(X)?X:[X]]));return B.displayName=`${_}`,B};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=ne("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=ne("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=ne("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=ne("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=ne("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=ne("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=ne("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pr=ne("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ur=ne("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mr=ne("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=ne("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xr=ne("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=ne("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hr=ne("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=ne("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gr=ne("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pt=ne("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=ne("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=ne("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=ne("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=ne("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fr=ne("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=ne("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const br=ne("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jr=ne("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ne("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=ne("ShoppingCart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yr=ne("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=ne("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=ne("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Et=ne("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=ne("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=ne("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vr=ne("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=ne("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function me({children:_}){const[E,B]=o.useState(!1),R=_t(),N=D=>R.pathname===D;return e.jsxs("div",{className:"layout",children:[e.jsx("button",{className:"menu-toggle",onClick:()=>B(!E),children:E?e.jsx(Te,{size:24}):e.jsx(gr,{size:24})}),e.jsxs("aside",{className:`sidebar ${E?"open":""}`,children:[e.jsxs("div",{className:"sidebar-logo",children:[e.jsx($e,{size:28}),e.jsx("span",{children:"TejidosApp"})]}),e.jsxs("nav",{className:"sidebar-nav",children:[e.jsxs(Pe,{to:"/dashboard",className:`nav-item ${N("/dashboard")?"active":""}`,children:[e.jsx(yt,{size:20}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(Pe,{to:"/productos",className:`nav-item ${N("/productos")?"active":""}`,children:[e.jsx($e,{size:20}),e.jsx("span",{children:"Productos"})]}),e.jsxs(Pe,{to:"/stock",className:`nav-item ${N("/stock")?"active":""}`,children:[e.jsx($e,{size:20}),e.jsx("span",{children:"Stock"})]}),e.jsxs(Pe,{to:"/ventas",className:`nav-item ${N("/ventas")?"active":""}`,children:[e.jsx(et,{size:20}),e.jsx("span",{children:"Ventas"})]}),e.jsxs(Pe,{to:"/promociones",className:`nav-item ${N("/promociones")?"active":""}`,children:[e.jsx(yr,{size:20}),e.jsx("span",{children:"Promociones"})]}),e.jsxs(Pe,{to:"/presupuestos",className:`nav-item ${N("/presupuestos")?"active":""}`,children:[e.jsx(mt,{size:20}),e.jsx("span",{children:"Presupuestos"})]}),e.jsxs(Pe,{to:"/rutas",className:`nav-item ${N("/rutas")?"active":""}`,children:[e.jsx(Ft,{size:20}),e.jsx("span",{children:"Rutas"})]}),e.jsxs(Pe,{to:"/compras",className:`nav-item ${N("/compras")?"active":""}`,children:[e.jsx(tt,{size:20}),e.jsx("span",{children:"Compras"})]}),e.jsxs(Pe,{to:"/gastos",className:`nav-item ${N("/gastos")?"active":""}`,children:[e.jsx(br,{size:20}),e.jsx("span",{children:"Gastos"})]}),e.jsxs(Pe,{to:"/clientes",className:`nav-item ${N("/clientes")?"active":""}`,children:[e.jsx(ct,{size:20}),e.jsx("span",{children:"Clientes"})]}),e.jsxs(Pe,{to:"/proveedores",className:`nav-item ${N("/proveedores")?"active":""}`,children:[e.jsx(Et,{size:20}),e.jsx("span",{children:"Proveedores"})]}),e.jsxs(Pe,{to:"/reportes",className:`nav-item ${N("/reportes")?"active":""}`,children:[e.jsx(yt,{size:20}),e.jsx("span",{children:"Reportes"})]})]})]}),e.jsx("main",{className:"main-content",children:_})]})}function _r(){const _=rt(),{user:E,signOut:B}=ut(),[R,N]=o.useState({totalProductos:0,ventasHoy:0,ventasMes:0,gananciasMes:0,comprasMes:0,totalClientes:0,productoMasVendido:null,productoMenosVendido:null,cantidadTotalVendidaMes:0}),[,D]=o.useState(!0),[w,G]=o.useState(null);o.useEffect(()=>{(async()=>{const{data:{user:I}}=await c.auth.getUser();if(I){const{data:A}=await c.from("usuarios").select("empresa_id").eq("auth_id",I.id).single();A&&G(A.empresa_id)}})()},[]),o.useEffect(()=>{w&&X()},[w]);const X=async()=>{var y,I,A,q,u,k;if(w)try{const f=new Date,Q=new Date(f.setHours(0,0,0,0)).toISOString(),O=new Date(f.getFullYear(),f.getMonth(),1).toISOString(),[x,h,i,l,P]=await Promise.all([c.from("productos").select("*").eq("activo",!0).eq("empresa_id",w),c.from("ventas").select("total").gte("fecha_venta",Q).eq("empresa_id",w),c.from("ventas").select("id, total").gte("fecha_venta",O).eq("empresa_id",w),c.from("compras").select("total").gte("fecha_compra",O).eq("empresa_id",w),c.from("clientes").select("*").eq("activo",!0).eq("empresa_id",w)]),W=((y=x.data)==null?void 0:y.length)||0,ee=((I=h.data)==null?void 0:I.reduce((J,s)=>J+(s.total||0),0))||0,H=((A=i.data)==null?void 0:A.reduce((J,s)=>J+(s.total||0),0))||0,j=((q=l.data)==null?void 0:q.reduce((J,s)=>J+(s.total||0),0))||0,v=((u=P.data)==null?void 0:u.length)||0,F=((k=i.data)==null?void 0:k.map(J=>J.id))||[];let a=[];if(F.length>0){const{data:J}=await c.from("detalle_ventas").select(`
            cantidad,
            precio_unitario,
            venta_id,
            producto:productos(id, nombre, codigo_producto, precio_costo_m2, precio_compra_uyu, m2_rollo)
          `).in("venta_id",F).eq("empresa_id",w);a=J||[]}let V=0,p=0;const T={},{data:z}=await c.from("cotizacion_dolar").select("valor").eq("empresa_id",w).maybeSingle(),oe=(z==null?void 0:z.valor)||0;a&&a.forEach(J=>{const s=J.producto;if(s){const Y=parseFloat(J.precio_unitario)||0,d=parseFloat(J.cantidad)||0;let C=0;s.precio_costo_m2&&oe>0?C=parseFloat(s.precio_costo_m2)*oe:s.precio_compra_uyu&&s.m2_rollo&&(C=parseFloat(s.precio_compra_uyu)/parseFloat(s.m2_rollo)),V+=(Y-C)*d,p+=d;const L=s.id;T[L]||(T[L]={nombre:s.nombre,codigo:s.codigo_producto,cantidad:0}),T[L].cantidad+=d}});const le=Object.values(T).sort((J,s)=>s.cantidad-J.cantidad),te=le.length>0?le[0]:null,ce=le.length>0?le[le.length-1]:null;N({totalProductos:W,ventasHoy:ee,ventasMes:H,gananciasMes:V,comprasMes:j,totalClientes:v,productoMasVendido:te,productoMenosVendido:ce,cantidadTotalVendidaMes:p})}catch(f){console.error("Error loading metrics:",f)}finally{D(!1)}},M=async()=>{await B(),_("/login")};return e.jsx(me,{children:e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Panel de Control"}),e.jsxs("p",{children:["Bienvenido ",E==null?void 0:E.email]})]}),e.jsxs("button",{onClick:M,className:"btn-logout",children:[e.jsx(hr,{size:20}),"Cerrar Sesión"]})]}),e.jsx("div",{style:{marginBottom:"2rem"},children:e.jsxs("button",{onClick:()=>_("/nueva-venta"),style:{width:"100%",padding:"1.5rem",fontSize:"1.25rem",fontWeight:"600",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"12px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",transition:"all 0.2s"},onMouseEnter:y=>{y.currentTarget.style.backgroundColor="#15803d",y.currentTarget.style.transform="translateY(-2px)",y.currentTarget.style.boxShadow="0 6px 8px rgba(0, 0, 0, 0.15)"},onMouseLeave:y=>{y.currentTarget.style.backgroundColor="#16a34a",y.currentTarget.style.transform="translateY(0)",y.currentTarget.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)"},children:[e.jsx(et,{size:28}),"Cargar Nueva Venta"]})}),e.jsxs("div",{className:"metrics-grid",children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#e0e7ff"},children:e.jsx($e,{size:24,color:"#2563eb"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Productos"}),e.jsx("p",{className:"metric-value",children:R.totalProductos})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#d1fae5"},children:e.jsx(et,{size:24,color:"#10b981"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Ventas Hoy"}),e.jsxs("p",{className:"metric-value",children:["$ ",R.ventasHoy.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#dbeafe"},children:e.jsx(Qe,{size:24,color:"#0284c7"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Ventas del Mes"}),e.jsxs("p",{className:"metric-value",children:["$ ",R.ventasMes.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#fef3c7"},children:e.jsx(Qe,{size:24,color:"#f59e0b"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Ganancia del Mes"}),e.jsxs("p",{className:"metric-value",children:["$ ",R.gananciasMes.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#fee2e2"},children:e.jsx(tt,{size:24,color:"#ef4444"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Compras del Mes"}),e.jsxs("p",{className:"metric-value",children:["$ ",R.comprasMes.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#e0e7ff"},children:e.jsx(ct,{size:24,color:"#2563eb"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Clientes"}),e.jsx("p",{className:"metric-value",children:R.totalClientes})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#dcfce7"},children:e.jsx(dr,{size:24,color:"#16a34a"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Producto Más Vendido"}),R.productoMasVendido?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"metric-value",style:{fontSize:"1rem",lineHeight:"1.2"},children:R.productoMasVendido.codigo}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:["Cantidad: ",R.productoMasVendido.cantidad]})]}):e.jsx("p",{className:"metric-value",style:{fontSize:"0.9rem"},children:"Sin datos"})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#fef3c7"},children:e.jsx(Fe,{size:24,color:"#d97706"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Producto Menos Vendido"}),R.productoMenosVendido?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"metric-value",style:{fontSize:"1rem",lineHeight:"1.2"},children:R.productoMenosVendido.codigo}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:["Cantidad: ",R.productoMenosVendido.cantidad]})]}):e.jsx("p",{className:"metric-value",style:{fontSize:"0.9rem"},children:"Sin datos"})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#dbeafe"},children:e.jsx($e,{size:24,color:"#0284c7"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Unidades Vendidas (Mes)"}),e.jsx("p",{className:"metric-value",children:R.cantidadTotalVendidaMes})]})]})]}),e.jsxs("div",{className:"quick-actions",children:[e.jsx("h2",{children:"Acciones Rápidas"}),e.jsxs("div",{className:"actions-grid",children:[e.jsxs("button",{onClick:()=>_("/compras"),className:"action-btn",children:[e.jsx(tt,{size:20}),"Nueva Compra"]}),e.jsxs("button",{onClick:()=>_("/productos"),className:"action-btn",children:[e.jsx($e,{size:20}),"Gestionar Productos"]}),e.jsxs("button",{onClick:()=>_("/stock"),className:"action-btn",children:[e.jsx($e,{size:20}),"Control de Stock"]}),e.jsxs("button",{onClick:()=>_("/clientes"),className:"action-btn",children:[e.jsx(ct,{size:20}),"Gestionar Clientes"]}),e.jsxs("button",{onClick:()=>_("/reportes"),className:"action-btn",children:[e.jsx(Qe,{size:20}),"Ver Reportes"]})]})]})]})})}function Cr(){const[_,E]=o.useState([]),[B,R]=o.useState([]),[N,D]=o.useState(!0),[w,G]=o.useState(""),[X,M]=o.useState(!1),[y,I]=o.useState(null),[A,q]=o.useState(null),[u,k]=o.useState(null),[f,Q]=o.useState(!1),[O,x]=o.useState(""),[h,i]=o.useState(null),[l,P]=o.useState({}),[W,ee]=o.useState(null),[H,j]=o.useState("asc"),[v,F]=o.useState({codigo:"",nombre:"",subtipo:"",altura:"",largo:"",separacion:"",precio_costo:"",precio_costo_m2:"",precio_venta:"",precio_venta_m2:""}),[a,V]=o.useState(null),[p,T]=o.useState(null),[z,oe]=o.useState({codigo_producto:"",nombre:"",subtipo:"",descripcion:"",categoria_id:"",precio_compra:"",precio_venta:"",precio_compra_uyu:"",precio_venta_usd:"",precio_costo_m2:"",precio_venta_m2:"",altura_m:"",largo_m:"",separacion_cm:"",m2_rollo:""});o.useEffect(()=>{(async()=>{var $;const{data:{session:g}}=await c.auth.getSession();console.log("Sesión actual:",($=g==null?void 0:g.user)==null?void 0:$.email);const{data:b}=await c.from("empresas").select("id").single();b&&(q(b.id),le(b.id)),ce(),te()})()},[]);const le=async r=>{try{const{data:g}=await c.from("cotizacion_dolar").select("valor").eq("empresa_id",r).eq("fecha",new Date().toISOString().split("T")[0]).maybeSingle();if(g)k(g.valor);else{const{data:b}=await c.from("cotizacion_dolar").select("valor").eq("empresa_id",r).lte("fecha",new Date().toISOString().split("T")[0]).order("fecha",{ascending:!1}).limit(1).maybeSingle();b&&k(b.valor)}}catch(g){console.error("Error fetching cotizacion:",g)}},te=async()=>{try{const{data:r,error:g}=await c.from("categorias").select("id, nombre").order("nombre");if(g)throw g;R(r||[])}catch(r){console.error("Error fetching categorias:",r)}},ce=async()=>{try{const{data:r,error:g}=await c.from("productos").select(`
          *,
          categoria:categorias(nombre)
        `).order("creado_en",{ascending:!1});if(g)throw console.error("Error fetching productos:",g),g;console.log("Productos cargados:",r==null?void 0:r.length,r),E(r||[])}catch(r){console.error("Error en fetchProductos:",r),alert("Error al cargar productos: "+r.message)}finally{D(!1)}},J=(r,g)=>{const b=g===""?0:parseFloat(g),$={...z,[r]:g},de=parseFloat($.altura_m)||0,he=parseFloat($.largo_m)||0,pe=de*he;u&&(r==="precio_costo_m2"&&b>0&&de>0?($.precio_compra=(b*de*25).toFixed(2),$.precio_compra_uyu=(b*de*25*u).toFixed(2)):r==="precio_compra"&&b>0?($.precio_compra_uyu=(b*u).toFixed(2),de>0&&($.precio_costo_m2=(b/(de*25)).toFixed(2))):r==="precio_compra_uyu"&&b>0?($.precio_compra=(b/u).toFixed(2),de>0&&($.precio_costo_m2=(b/u/(de*25)).toFixed(2))):r==="precio_venta_m2"&&b>0&&pe>0?($.precio_venta=(b*pe).toFixed(2),$.precio_venta_usd=(b*pe/u).toFixed(2)):r==="precio_venta"&&b>0?($.precio_venta_usd=(b/u).toFixed(2),pe>0&&($.precio_venta_m2=(b/pe).toFixed(2))):r==="precio_venta_usd"&&b>0&&($.precio_venta=(b*u).toFixed(2),pe>0&&($.precio_venta_m2=(b*u/pe).toFixed(2)))),oe($)},s=(r,g)=>{const b={...z,[r]:g},$=parseFloat(r==="altura_m"?g:z.altura_m)||0,de=parseFloat(r==="largo_m"?g:z.largo_m)||0,he=$*de;if(u){const pe=parseFloat(z.precio_costo_m2)||0,je=parseFloat(z.precio_venta_m2)||0;pe>0&&$>0&&(b.precio_compra=(pe*$*25).toFixed(2),b.precio_compra_uyu=(pe*$*25*u).toFixed(2)),je>0&&he>0&&(b.precio_venta=(je*he).toFixed(2),b.precio_venta_usd=(je*he/u).toFixed(2))}oe(b)},Y=async()=>{if(!(!A||!O))try{const{error:r}=await c.from("cotizacion_dolar").upsert({empresa_id:A,fecha:new Date().toISOString().split("T")[0],valor:parseFloat(O)},{onConflict:"fecha,empresa_id"});if(r)throw r;k(parseFloat(O)),Q(!1),x(""),alert("Cotización guardada correctamente")}catch(r){alert("Error al guardar cotización: "+r.message)}},d=r=>{var b;const g=(b=r.target.files)==null?void 0:b[0];if(g){if(g.size>5242880){alert("La imagen no puede superar 5MB");return}V(g);const $=new FileReader;$.onloadend=()=>{T($.result)},$.readAsDataURL(g)}},C=async(r,g)=>{try{const b=r.name.split(".").pop(),de=`${`${g}-${Date.now()}.${b}`}`,{error:he}=await c.storage.from("producto-imagenes").upload(de,r,{cacheControl:"3600",upsert:!0});if(he)throw he;const{data:pe}=c.storage.from("producto-imagenes").getPublicUrl(de);return pe.publicUrl}catch(b){return console.error("Error al subir imagen:",b),alert("Error al subir la imagen: "+b.message),null}},L=r=>{var Re,Ae,ve,Ie,Se,We,Ge,qe;I(r.id);const g=r.altura_m||0,b=r.largo_m||0,$=g*b,de=r.precio_costo_m2||0,he=r.precio_venta_m2||0;let pe="",je="",ie="",ye="";u&&(de>0&&g>0&&(pe=(de*g*25).toFixed(2),je=(de*g*25*u).toFixed(2)),he>0&&$>0&&(ie=(he*$).toFixed(2),ye=(he*$/u).toFixed(2))),oe({codigo_producto:r.codigo_producto,nombre:r.nombre,subtipo:r.subtipo||"",descripcion:r.descripcion||"",categoria_id:r.categoria_id,precio_compra:pe||r.precio_compra.toString(),precio_venta:ie||r.precio_venta.toString(),precio_compra_uyu:je||((Re=r.precio_compra_uyu)==null?void 0:Re.toString())||"",precio_venta_usd:ye||((Ae=r.precio_venta_usd)==null?void 0:Ae.toString())||"",precio_costo_m2:((ve=r.precio_costo_m2)==null?void 0:ve.toString())||"",precio_venta_m2:((Ie=r.precio_venta_m2)==null?void 0:Ie.toString())||"",altura_m:((Se=r.altura_m)==null?void 0:Se.toString())||"",largo_m:((We=r.largo_m)==null?void 0:We.toString())||"",separacion_cm:((Ge=r.separacion_cm)==null?void 0:Ge.toString())||"",m2_rollo:((qe=r.m2_rollo)==null?void 0:qe.toString())||""}),T(r.imagen_url||null),V(null),M(!0)},Z=async r=>{if(r.preventDefault(),!!A)try{const g={...z,empresa_id:A,precio_compra:parseFloat(z.precio_compra)||0,precio_venta:parseFloat(z.precio_venta)||0,precio_compra_uyu:z.precio_compra_uyu?parseFloat(z.precio_compra_uyu):null,precio_venta_usd:z.precio_venta_usd?parseFloat(z.precio_venta_usd):null,precio_costo_m2:z.precio_costo_m2?parseFloat(z.precio_costo_m2):null,precio_venta_m2:z.precio_venta_m2?parseFloat(z.precio_venta_m2):null,altura_m:z.altura_m?parseFloat(z.altura_m):null,largo_m:z.largo_m?parseFloat(z.largo_m):null,separacion_cm:z.separacion_cm?parseFloat(z.separacion_cm):null,m2_rollo:z.m2_rollo?parseFloat(z.m2_rollo):null};let b=y;if(y){const{error:$}=await c.from("productos").update(g).eq("id",y);if($)throw $}else{const{data:$,error:de}=await c.from("productos").insert([g]).select().single();if(de)throw de;b=$.id}if(a&&b){const $=await C(a,b);if($){const{error:de}=await c.from("productos").update({imagen_url:$}).eq("id",b);if(de)throw de}}ce(),M(!1),ae(),alert(y?"Producto actualizado":"Producto creado")}catch(g){alert("Error: "+g.message)}},ae=()=>{oe({codigo_producto:"",nombre:"",subtipo:"",descripcion:"",categoria_id:"",precio_compra:"",precio_venta:"",precio_compra_uyu:"",precio_venta_usd:"",precio_costo_m2:"",precio_venta_m2:"",altura_m:"",largo_m:"",separacion_cm:"",m2_rollo:""}),I(null),V(null),T(null)},se=async r=>{if(confirm("¿Eliminar este producto?"))try{const{error:g}=await c.from("productos").delete().eq("id",r);if(g)throw g;ce()}catch(g){alert("Error: "+g.message)}},be=r=>{var g,b,$,de,he;i(r.id),P({codigo_producto:r.codigo_producto,nombre:r.nombre,subtipo:r.subtipo||"",altura_m:((g=r.altura_m)==null?void 0:g.toString())||"",largo_m:((b=r.largo_m)==null?void 0:b.toString())||"",separacion_cm:(($=r.separacion_cm)==null?void 0:$.toString())||"",precio_costo_m2:((de=r.precio_costo_m2)==null?void 0:de.toString())||"",precio_venta:r.precio_venta.toString(),precio_venta_m2:((he=r.precio_venta_m2)==null?void 0:he.toString())||""})},ze=async()=>{if(h)try{const r={codigo_producto:l.codigo_producto,nombre:l.nombre,subtipo:l.subtipo,altura_m:l.altura_m?parseFloat(l.altura_m):null,largo_m:l.largo_m?parseFloat(l.largo_m):null,separacion_cm:l.separacion_cm?parseFloat(l.separacion_cm):null,precio_costo_m2:l.precio_costo_m2?parseFloat(l.precio_costo_m2):null,precio_venta:parseFloat(l.precio_venta)||0,precio_venta_m2:l.precio_venta_m2?parseFloat(l.precio_venta_m2):null},{error:g}=await c.from("productos").update(r).eq("id",h);if(g)throw g;ce(),i(null),P({})}catch(r){alert("Error: "+r.message)}},re=()=>{i(null),P({})},n=r=>{W===r?j(H==="asc"?"desc":"asc"):(ee(r),j("asc"))},m=_.filter(r=>{var de,he,pe,je,ie,ye,Re,Ae,ve,Ie,Se,We,Ge,qe;const g=w.toLowerCase(),b=(((de=r.codigo_producto)==null?void 0:de.toLowerCase())||"").includes(g)||(((he=r.nombre)==null?void 0:he.toLowerCase())||"").includes(g)||(((pe=r.subtipo)==null?void 0:pe.toLowerCase())||"").includes(g)||(((ie=(je=r.categoria)==null?void 0:je.nombre)==null?void 0:ie.toLowerCase())||"").includes(g),$=(((ye=r.codigo_producto)==null?void 0:ye.toLowerCase())||"").includes(v.codigo.toLowerCase())&&((((Re=r.nombre)==null?void 0:Re.toLowerCase())||"").includes(v.nombre.toLowerCase())||(((Ae=r.subtipo)==null?void 0:Ae.toLowerCase())||"").includes(v.nombre.toLowerCase()))&&(v.altura===""||(((ve=r.altura_m)==null?void 0:ve.toString())||"").includes(v.altura))&&(v.largo===""||(((Ie=r.largo_m)==null?void 0:Ie.toString())||"").includes(v.largo))&&(v.separacion===""||(((Se=r.separacion_cm)==null?void 0:Se.toString())||"").includes(v.separacion))&&(v.precio_costo_m2===""||(((We=r.precio_costo_m2)==null?void 0:We.toString())||"").includes(v.precio_costo_m2))&&(v.precio_venta===""||(((Ge=r.precio_venta)==null?void 0:Ge.toString())||"").includes(v.precio_venta))&&(v.precio_venta_m2===""||(((qe=r.precio_venta_m2)==null?void 0:qe.toString())||"").includes(v.precio_venta_m2));return b&&$}).sort((r,g)=>{if(!W)return 0;let b,$;switch(W){case"codigo":b=r.codigo_producto,$=g.codigo_producto;break;case"nombre":b=r.nombre,$=g.nombre;break;case"altura":b=r.altura_m||0,$=g.altura_m||0;break;case"largo":b=r.largo_m||0,$=g.largo_m||0;break;case"separacion":b=r.separacion_cm||0,$=g.separacion_cm||0;break;case"precio_costo":b=r.altura_m&&r.precio_costo_m2?r.altura_m*25*r.precio_costo_m2:0,$=g.altura_m&&g.precio_costo_m2?g.altura_m*25*g.precio_costo_m2:0;break;case"precio_costo_m2":b=r.precio_costo_m2||0,$=g.precio_costo_m2||0;break;case"precio_venta":b=r.precio_venta||0,$=g.precio_venta||0;break;case"precio_venta_m2":b=r.precio_venta_m2||0,$=g.precio_venta_m2||0;break;default:return 0}return typeof b=="string"&&typeof $=="string"?H==="asc"?b.localeCompare($):$.localeCompare(b):H==="asc"?b-$:$-b});return N?e.jsx(me,{children:e.jsx("div",{style:{padding:"24px"},children:"Cargando productos..."})}):(console.log("Renderizando con productos:",_.length),e.jsx(me,{children:e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsxs("div",{children:[e.jsxs("h1",{style:{fontSize:"28px",fontWeight:"700",color:"#1f2937"},children:["Productos (",m.length,")"]}),u&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginTop:"8px",color:"#6b7280"},children:[e.jsx(et,{size:16}),e.jsxs("span",{children:["Cotización: $",u.toFixed(2)]}),e.jsx("button",{onClick:()=>Q(!0),style:{background:"none",border:"none",color:"#2563eb",cursor:"pointer",textDecoration:"underline",fontSize:"14px"},children:"Actualizar"})]}),!u&&e.jsx("button",{onClick:()=>Q(!0),style:{marginTop:"8px",padding:"6px 12px",background:"#f59e0b",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},children:"Configurar cotización del dólar"})]}),e.jsxs("button",{onClick:()=>{ae(),M(!0)},style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px 20px",background:"#2563eb",color:"white",border:"none",borderRadius:"8px",fontWeight:"600",cursor:"pointer"},children:[e.jsx(Ne,{size:20}),"Nuevo Producto"]})]}),e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs("div",{style:{position:"relative",maxWidth:"400px"},children:[e.jsx(Ke,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#6b7280"}}),e.jsx("input",{type:"text",placeholder:"Buscar por código, nombre, subtipo o categoría...",value:w,onChange:r=>G(r.target.value),style:{width:"100%",padding:"12px 12px 12px 44px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none"}})]})}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsxs("thead",{children:[e.jsxs("tr",{style:{background:"#f9fafb",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("th",{onClick:()=>n("codigo"),style:{padding:"16px",textAlign:"left",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:["Código",W==="codigo"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{onClick:()=>n("nombre"),style:{padding:"16px",textAlign:"left",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:["Producto",W==="nombre"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{onClick:()=>n("altura"),style:{padding:"16px",textAlign:"center",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:["Altura (m)",W==="altura"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{onClick:()=>n("largo"),style:{padding:"16px",textAlign:"center",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:["Largo (m)",W==="largo"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{onClick:()=>n("separacion"),style:{padding:"16px",textAlign:"center",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:["Separación (cm)",W==="separacion"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{onClick:()=>n("precio_costo"),style:{padding:"16px",textAlign:"right",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"4px"},children:["Precio Costo",W==="precio_costo"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{onClick:()=>n("precio_costo_m2"),style:{padding:"16px",textAlign:"right",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"4px"},children:["Precio Costo m²",W==="precio_costo_m2"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{onClick:()=>n("precio_venta"),style:{padding:"16px",textAlign:"right",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"4px"},children:["Precio Venta",W==="precio_venta"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{onClick:()=>n("precio_venta_m2"),style:{padding:"16px",textAlign:"right",fontWeight:"600",cursor:"pointer",userSelect:"none"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"4px"},children:["Precio Venta m²",W==="precio_venta_m2"&&(H==="asc"?e.jsx(Ve,{size:16}):e.jsx(Le,{size:16}))]})}),e.jsx("th",{style:{padding:"16px",textAlign:"center",fontWeight:"600"},children:"Acciones"})]}),e.jsxs("tr",{style:{background:"#f3f4f6",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("th",{style:{padding:"8px"},children:e.jsx("input",{type:"text",placeholder:"Filtrar...",value:v.codigo,onChange:r=>F({...v,codigo:r.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px"},onClick:r=>r.stopPropagation()})}),e.jsx("th",{style:{padding:"8px"},children:e.jsx("input",{type:"text",placeholder:"Filtrar...",value:v.nombre,onChange:r=>F({...v,nombre:r.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px"},onClick:r=>r.stopPropagation()})}),e.jsx("th",{style:{padding:"8px"},children:e.jsx("input",{type:"text",placeholder:"Filtrar...",value:v.altura,onChange:r=>F({...v,altura:r.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px",textAlign:"center"},onClick:r=>r.stopPropagation()})}),e.jsx("th",{style:{padding:"8px"},children:e.jsx("input",{type:"text",placeholder:"Filtrar...",value:v.largo,onChange:r=>F({...v,largo:r.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px",textAlign:"center"},onClick:r=>r.stopPropagation()})}),e.jsx("th",{style:{padding:"8px"},children:e.jsx("input",{type:"text",placeholder:"Filtrar...",value:v.separacion,onChange:r=>F({...v,separacion:r.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px",textAlign:"center"},onClick:r=>r.stopPropagation()})}),e.jsx("th",{style:{padding:"8px"}}),e.jsx("th",{style:{padding:"8px"},children:e.jsx("input",{type:"text",placeholder:"Filtrar...",value:v.precio_costo_m2,onChange:r=>F({...v,precio_costo_m2:r.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px",textAlign:"right"},onClick:r=>r.stopPropagation()})}),e.jsx("th",{style:{padding:"8px"},children:e.jsx("input",{type:"text",placeholder:"Filtrar...",value:v.precio_venta,onChange:r=>F({...v,precio_venta:r.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px",textAlign:"right"},onClick:r=>r.stopPropagation()})}),e.jsx("th",{style:{padding:"8px"},children:e.jsx("input",{type:"text",placeholder:"Filtrar...",value:v.precio_venta_m2,onChange:r=>F({...v,precio_venta_m2:r.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #d1d5db",borderRadius:"4px",fontSize:"13px",textAlign:"right"},onClick:r=>r.stopPropagation()})}),e.jsx("th",{style:{padding:"8px"}})]})]}),e.jsx("tbody",{children:m.map(r=>{const g=h===r.id;return e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb",background:g?"#f0f9ff":"transparent",cursor:g?"default":"pointer"},onDoubleClick:()=>!g&&be(r),title:g?"":"Doble clic para editar",children:[e.jsx("td",{style:{padding:"8px"},children:g?e.jsx("input",{type:"text",value:l.codigo_producto,onChange:b=>P({...l,codigo_producto:b.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"14px"}}):r.codigo_producto}),e.jsx("td",{style:{padding:"8px"},children:g?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",value:l.nombre,onChange:b=>P({...l,nombre:b.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"14px",marginBottom:"4px"},placeholder:"Nombre"}),e.jsx("input",{type:"text",value:l.subtipo,onChange:b=>P({...l,subtipo:b.target.value}),style:{width:"100%",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"12px"},placeholder:"Subtipo"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{fontWeight:"600"},children:r.nombre}),e.jsx("div",{style:{fontSize:"14px",color:"#6b7280"},children:r.subtipo})]})}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:g?e.jsx("input",{type:"number",step:"0.01",value:l.altura_m,onChange:b=>P({...l,altura_m:b.target.value}),style:{width:"80px",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"14px",textAlign:"center"}}):r.altura_m?r.altura_m:"-"}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:g?e.jsx("input",{type:"number",step:"0.01",value:l.largo_m,onChange:b=>P({...l,largo_m:b.target.value}),style:{width:"80px",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"14px",textAlign:"center"}}):r.largo_m?r.largo_m:"-"}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:g?e.jsx("input",{type:"number",step:"0.01",value:l.separacion_cm,onChange:b=>P({...l,separacion_cm:b.target.value}),style:{width:"80px",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"14px",textAlign:"center"}}):r.separacion_cm?r.separacion_cm:"-"}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:g?l.altura_m&&l.precio_costo_m2?`US$${(parseFloat(l.altura_m)*25*parseFloat(l.precio_costo_m2)).toFixed(2)}`:"-":r.altura_m&&r.precio_costo_m2?`US$${(r.altura_m*25*r.precio_costo_m2).toFixed(2)}`:"-"}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:g?e.jsx("input",{type:"number",step:"0.01",value:l.precio_costo_m2,onChange:b=>P({...l,precio_costo_m2:b.target.value}),style:{width:"100px",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"14px",textAlign:"right"},placeholder:"0.00"}):r.precio_costo_m2?`US$${Number(r.precio_costo_m2).toFixed(2)}`:"-"}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:g?e.jsx("input",{type:"number",step:"0.01",value:l.precio_venta,onChange:b=>P({...l,precio_venta:b.target.value}),style:{width:"100px",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"14px",textAlign:"right"},placeholder:"0.00"}):`$U${Number(r.precio_venta||0).toLocaleString()}`}),e.jsx("td",{style:{padding:"8px",textAlign:"right"},children:g?e.jsx("input",{type:"number",step:"0.01",value:l.precio_venta_m2,onChange:b=>P({...l,precio_venta_m2:b.target.value}),style:{width:"100px",padding:"6px",border:"1px solid #3b82f6",borderRadius:"4px",fontSize:"14px",textAlign:"right"},placeholder:"0.00"}):r.precio_venta_m2?`$U${Number(r.precio_venta_m2).toFixed(2)}`:"-"}),e.jsx("td",{style:{padding:"8px",textAlign:"center"},children:g?e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"center"},children:[e.jsx("button",{onClick:ze,style:{padding:"8px",background:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Guardar",children:e.jsx(cr,{size:16})}),e.jsx("button",{onClick:re,style:{padding:"8px",background:"#6b7280",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Cancelar",children:e.jsx(Te,{size:16})})]}):e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>L(r),style:{padding:"8px",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Editar en modal",children:e.jsx(ht,{size:16})}),e.jsx("button",{onClick:()=>se(r.id),style:{padding:"8px",background:"#ef4444",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},title:"Eliminar",children:e.jsx(Ee,{size:16})})]})})]},r.id)})})]}),m.length===0&&e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#6b7280"},children:w?"No se encontraron productos":"No hay productos registrados"})]}),f&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",width:"90%",maxWidth:"400px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"700",marginBottom:"20px"},children:"Cotización del Dólar"}),e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Valor en Pesos Uruguayos"}),e.jsx("input",{type:"number",step:"0.01",value:O,onChange:r=>x(r.target.value),placeholder:"Ej: 40.50",style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>{Q(!1),x("")},style:{padding:"10px 20px",background:"#e5e7eb",border:"none",borderRadius:"8px",fontWeight:"600",cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:Y,style:{padding:"10px 20px",background:"#2563eb",color:"white",border:"none",borderRadius:"8px",fontWeight:"600",cursor:"pointer"},children:"Guardar"})]})]})}),X&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,overflowY:"auto",padding:"20px"},children:e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",width:"90%",maxWidth:"800px",maxHeight:"90vh",overflowY:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"700"},children:y?"Editar Producto":"Nuevo Producto"}),e.jsx("button",{onClick:()=>{M(!1),ae()},style:{background:"none",border:"none",cursor:"pointer",padding:"4px"},children:e.jsx(Te,{size:24})})]}),e.jsxs("form",{onSubmit:Z,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Código *"}),e.jsx("input",{type:"text",required:!0,value:z.codigo_producto,onChange:r=>oe({...z,codigo_producto:r.target.value}),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Nombre *"}),e.jsx("input",{type:"text",required:!0,value:z.nombre,onChange:r=>oe({...z,nombre:r.target.value}),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Categoría *"}),e.jsxs("select",{required:!0,value:z.categoria_id,onChange:r=>oe({...z,categoria_id:r.target.value}),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"},children:[e.jsx("option",{value:"",children:"Seleccionar categoría"}),B.map(r=>e.jsx("option",{value:r.id,children:r.nombre},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Subtipo"}),e.jsx("input",{type:"text",value:z.subtipo,onChange:r=>oe({...z,subtipo:r.target.value}),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Descripción"}),e.jsx("textarea",{value:z.descripcion,onChange:r=>oe({...z,descripcion:r.target.value}),rows:2,style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",resize:"vertical"}})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Imagen del Producto"}),e.jsx("input",{type:"file",accept:"image/*",onChange:d,style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}}),p&&e.jsxs("div",{style:{marginTop:"12px",textAlign:"center"},children:[e.jsx("img",{src:p,alt:"Preview",style:{maxWidth:"200px",maxHeight:"200px",borderRadius:"8px",border:"2px solid #e5e7eb"}}),e.jsx("button",{type:"button",onClick:()=>{V(null),T(null)},style:{display:"block",margin:"8px auto 0",padding:"6px 12px",background:"#ef4444",color:"white",border:"none",borderRadius:"6px",fontSize:"13px",cursor:"pointer"},children:"Eliminar imagen"})]})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",marginTop:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"12px",color:"#1f2937"},children:"Precios"}),!u&&e.jsx("div",{style:{padding:"12px",background:"#fef3c7",border:"1px solid #fbbf24",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:"Configure la cotización del dólar para cálculos automáticos"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Precio Costo m² (USD) *"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:z.precio_costo_m2,onChange:r=>J("precio_costo_m2",r.target.value),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Precio Costo (USD)"}),e.jsx("input",{type:"number",step:"0.01",value:z.precio_compra,onChange:r=>J("precio_compra",r.target.value),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",background:"#f9fafb"},readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Precio Costo (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:z.precio_compra_uyu,onChange:r=>J("precio_compra_uyu",r.target.value),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",background:"#f9fafb"},readOnly:!0,disabled:!u})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Precio Venta m² (UYU) *"}),e.jsx("input",{type:"number",step:"0.01",required:!0,value:z.precio_venta_m2,onChange:r=>J("precio_venta_m2",r.target.value),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Precio Venta (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:z.precio_venta,onChange:r=>J("precio_venta",r.target.value),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",background:"#f9fafb"},readOnly:!0})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Precio Venta (USD)"}),e.jsx("input",{type:"number",step:"0.01",value:z.precio_venta_usd,onChange:r=>J("precio_venta_usd",r.target.value),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",background:"#f9fafb"},readOnly:!0,disabled:!u})]})]})]}),e.jsxs("div",{style:{gridColumn:"1 / -1",marginTop:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"12px",color:"#1f2937"},children:"Dimensiones"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Altura (m)"}),e.jsx("input",{type:"number",step:"0.01",value:z.altura_m,onChange:r=>s("altura_m",r.target.value),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Largo (m)"}),e.jsx("input",{type:"number",step:"0.01",value:z.largo_m,onChange:r=>s("largo_m",r.target.value),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"Separación (cm)"}),e.jsx("input",{type:"number",step:"0.01",value:z.separacion_cm,onChange:r=>oe({...z,separacion_cm:r.target.value}),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",fontWeight:"500"},children:"m² por Rollo"}),e.jsx("input",{type:"number",step:"0.01",value:z.m2_rollo,onChange:r=>oe({...z,m2_rollo:r.target.value}),style:{width:"100%",padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px"}})]})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end",marginTop:"24px"},children:[e.jsx("button",{type:"button",onClick:()=>{M(!1),ae()},style:{padding:"10px 20px",background:"#e5e7eb",border:"none",borderRadius:"8px",fontWeight:"600",cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"10px 20px",background:"#2563eb",color:"white",border:"none",borderRadius:"8px",fontWeight:"600",cursor:"pointer"},children:y?"Actualizar":"Crear"})]})]})]})})]})}))}function Sr(){const[_,E]=o.useState([]),[B,R]=o.useState(!0),[N,D]=o.useState(null),[w,G]=o.useState({cantidad_disponible:0,cantidad_minima:0}),[X,M]=o.useState("");o.useEffect(()=>{y()},[]);const y=async()=>{try{const{data:k,error:f}=await c.from("stock").select(`
          *,
          producto:productos (
            codigo_producto,
            nombre,
            subtipo,
            altura_m,
            largo_m,
            separacion_cm,
            categoria:categorias (
              nombre
            )
          )
        `).order("cantidad_disponible",{ascending:!0});if(f)throw f;E(k||[])}catch(k){console.error("Error:",k)}finally{R(!1)}},I=k=>{D(k.id),G({cantidad_disponible:Number(k.cantidad_disponible),cantidad_minima:Number(k.cantidad_minima)})},A=()=>{D(null),G({cantidad_disponible:0,cantidad_minima:0})},q=async k=>{try{const{error:f}=await c.from("stock").update({cantidad_disponible:w.cantidad_disponible,cantidad_minima:w.cantidad_minima,actualizado_en:new Date().toISOString()}).eq("id",k);if(f)throw f;await y(),D(null)}catch(f){console.error("Error al actualizar stock:",f),alert("Error al actualizar stock")}},u=_.filter(k=>{var Q,O,x;if(!k.producto)return!1;const f=X.toLowerCase();return k.producto.codigo_producto.toLowerCase().includes(f)||k.producto.nombre.toLowerCase().includes(f)||((Q=k.producto.subtipo)==null?void 0:Q.toLowerCase().includes(f))||((x=(O=k.producto.categoria)==null?void 0:O.nombre)==null?void 0:x.toLowerCase().includes(f))});return B?e.jsx(me,{children:e.jsx("div",{children:"Cargando..."})}):e.jsx(me,{children:e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("h1",{style:{fontSize:"28px",fontWeight:"700",color:"#1f2937",marginBottom:"24px"},children:["Control de Stock (",u.length,")"]}),e.jsx("div",{style:{marginBottom:"24px"},children:e.jsxs("div",{style:{position:"relative",maxWidth:"400px"},children:[e.jsx(Ke,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#6b7280"}}),e.jsx("input",{type:"text",placeholder:"Buscar por código, nombre, subtipo o categoría...",value:X,onChange:k=>M(k.target.value),style:{width:"100%",padding:"12px 12px 12px 44px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none"}})]})}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",overflow:"hidden"},children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f9fafb",borderBottom:"1px solid #e5e7eb"},children:[e.jsx("th",{style:{padding:"16px",textAlign:"left",fontWeight:"600"},children:"Código"}),e.jsx("th",{style:{padding:"16px",textAlign:"left",fontWeight:"600"},children:"Producto"}),e.jsx("th",{style:{padding:"16px",textAlign:"left",fontWeight:"600"},children:"Categoría"}),e.jsx("th",{style:{padding:"16px",textAlign:"right",fontWeight:"600"},children:"Stock Actual"}),e.jsx("th",{style:{padding:"16px",textAlign:"right",fontWeight:"600"},children:"Stock Mínimo"}),e.jsx("th",{style:{padding:"16px",textAlign:"center",fontWeight:"600"},children:"Estado"}),e.jsx("th",{style:{padding:"16px",textAlign:"left",fontWeight:"600"},children:"Ubicación"}),e.jsx("th",{style:{padding:"16px",textAlign:"center",fontWeight:"600"},children:"Acciones"})]})}),e.jsx("tbody",{children:u.map(k=>{var P;const f=k.producto;if(!f)return null;let Q=`${f.nombre}`;f.subtipo&&(Q+=` - ${f.subtipo}`),(f.altura_m||f.largo_m||f.separacion_cm)&&(Q+=" (",f.altura_m&&(Q+=`${f.altura_m}m`),f.largo_m&&(Q+=` x ${f.largo_m}m`),f.separacion_cm&&(Q+=` - ${f.separacion_cm}cm`),Q+=")");const O=Number(k.cantidad_disponible),x=Number(k.cantidad_minima),h=O<=x?"Crítico":O<=x*2?"Bajo":"Normal",i=O<=x?"#ef4444":O<=x*2?"#f59e0b":"#10b981",l=N===k.id;return e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"16px",fontWeight:"600"},children:f.codigo_producto}),e.jsx("td",{style:{padding:"16px"},children:Q}),e.jsx("td",{style:{padding:"16px"},children:((P=f.categoria)==null?void 0:P.nombre)||"-"}),e.jsx("td",{style:{padding:"16px",textAlign:"right",fontWeight:"600",fontSize:"16px"},children:l?e.jsx("input",{type:"number",value:w.cantidad_disponible,onChange:W=>G({...w,cantidad_disponible:Number(W.target.value)}),style:{width:"80px",padding:"6px 10px",border:"2px solid #3b82f6",borderRadius:"6px",fontSize:"16px",fontWeight:"600",textAlign:"right"},min:"0"}):O}),e.jsx("td",{style:{padding:"16px",textAlign:"right",color:"#6b7280"},children:l?e.jsx("input",{type:"number",value:w.cantidad_minima,onChange:W=>G({...w,cantidad_minima:Number(W.target.value)}),style:{width:"80px",padding:"6px 10px",border:"2px solid #3b82f6",borderRadius:"6px",fontSize:"14px",textAlign:"right"},min:"0"}):x}),e.jsx("td",{style:{padding:"16px",textAlign:"center"},children:e.jsx("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"14px",fontWeight:"600",background:`${i}20`,color:i},children:h})}),e.jsx("td",{style:{padding:"16px",color:"#6b7280"},children:k.ubicacion||"-"}),e.jsx("td",{style:{padding:"16px",textAlign:"center"},children:l?e.jsxs("div",{style:{display:"flex",gap:"8px",justifyContent:"center"},children:[e.jsxs("button",{onClick:()=>q(k.id),style:{padding:"8px 12px",background:"#10b981",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontWeight:"600"},children:[e.jsx(jr,{size:16}),"Guardar"]}),e.jsxs("button",{onClick:A,style:{padding:"8px 12px",background:"#ef4444",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",fontWeight:"600"},children:[e.jsx(Te,{size:16}),"Cancelar"]})]}):e.jsxs("button",{onClick:()=>I(k),style:{padding:"8px 16px",background:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:"6px",fontWeight:"600"},children:[e.jsx(ht,{size:16}),"Editar"]})})]},k.id)})})]}),u.length===0&&e.jsx("div",{style:{padding:"40px",textAlign:"center",color:"#6b7280"},children:X?"No se encontraron productos":"No hay stock disponible"})]})]})})}delete it.Icon.Default.prototype._getIconUrl;it.Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png"});function wr({onLocationSelect:_,markerPosition:E,setMarkerPosition:B}){return Jt({click(R){const{lat:N,lng:D}=R.latlng;B([N,D]),_(N,D)}}),E===null?null:e.jsx(lt,{position:E})}function kr({center:_,zoom:E}){const B=Yt();return o.useEffect(()=>{B.flyTo(_,E)},[_,E,B]),null}const st=o.forwardRef(({onLocationSelect:_,initialPosition:E},B)=>{const R=E||[-34.9011,-56.1645],[N,D]=o.useState(R),[w,G]=o.useState(null),X=async y=>{if(!(!y||y.trim()===""))try{const A=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(y+", Uruguay")}&limit=1`)).json();if(A&&A.length>0){const q=parseFloat(A[0].lat),u=parseFloat(A[0].lon),k=[q,u];D(k),G(k),M(q,u)}}catch(I){console.error("Error buscando coordenadas:",I)}};o.useImperativeHandle(B,()=>({buscarDireccion:X}));const M=async(y,I)=>{try{const u=(await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${y}&lon=${I}`)).json()).display_name||`${y.toFixed(6)}, ${I.toFixed(6)}`;_(y,I,u)}catch(A){console.error("Error obteniendo dirección:",A),_(y,I,`${y.toFixed(6)}, ${I.toFixed(6)}`)}};return e.jsx("div",{style:{marginTop:"0.5rem",height:"400px",borderRadius:"8px",overflow:"hidden"},children:e.jsxs(St,{center:R,zoom:13,style:{height:"100%",width:"100%"},children:[e.jsx(wt,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(kr,{center:N,zoom:15}),e.jsx(wr,{onLocationSelect:M,markerPosition:w,setMarkerPosition:G})]})})});st.displayName="MapaPicker";const vt=(_,E)=>new Blob(["PDF temporarily disabled"],{type:"text/plain"});function Nr(){const _=_t(),[E,B]=o.useState([]),[R,N]=o.useState([]),[D,w]=o.useState([]),[G,X]=o.useState([]),[M,y]=o.useState([]),[I,A]=o.useState([]),[q,u]=o.useState([]),[k,f]=o.useState(!0),[Q,O]=o.useState(!1),[x,h]=o.useState(""),[i,l]=o.useState(!1),[P,W]=o.useState(null),ee=o.useRef(null),[H,j]=o.useState(null),[v,F]=o.useState(null),[a,V]=o.useState({}),[p,T]=o.useState(""),[z,oe]=o.useState(""),[le,te]=o.useState(""),[ce,J]=o.useState(""),[s,Y]=o.useState(""),[d,C]=o.useState(""),[L,Z]=o.useState(""),[ae,se]=o.useState(null),[be,ze]=o.useState(null),[re,n]=o.useState({cliente_id:"",fecha_venta:"",departamento:"",localidad:"",direccion:"",envio:"",descuento:"",notas:"",estado:""}),[m,r]=o.useState({numero_venta:"",cliente_id:"",fecha_venta:new Date().toISOString().split("T")[0],departamento:"Montevideo",localidad:"",direccion:"",envio:"",descuento:"",notas:"",envio_check:!1,reparto:!1}),g=["Artigas","Canelones","Cerro Largo","Colonia","Durazno","Flores","Florida","Lavalleja","Maldonado","Montevideo","Paysandú","Río Negro","Rivera","Rocha","Salto","San José","Soriano","Tacuarembó","Treinta y Tres"],b=["Canelones","Colonia","Maldonado","Montevideo","San José"],$={Artigas:["Artigas","Bella Unión","Tomás Gomensoro","Baltasar Brum"],Canelones:["Canelones","Ciudad de la Costa","Las Piedras","Pando","La Paz","Progreso","Santa Lucía","Atlántida","Parque del Plata"],"Cerro Largo":["Melo","Río Branco","Fraile Muerto","Aceguá"],Colonia:["Colonia del Sacramento","Carmelo","Nueva Helvecia","Juan Lacaze","Rosario","Tarariras"],Durazno:["Durazno","Sarandí del Yí","Villa del Carmen"],Flores:["Trinidad","Ismael Cortinas"],Florida:["Florida","Sarandí Grande","Fray Marcos","25 de Agosto"],Lavalleja:["Minas","José Pedro Varela","Solís de Mataojo"],Maldonado:["Maldonado","Punta del Este","San Carlos","Pan de Azúcar","Piriápolis"],Montevideo:["Montevideo","Ciudad Vieja","Centro","Cordón","Parque Rodó","Pocitos","Buceo","Carrasco","Malvín","Punta Carretas"],Paysandú:["Paysandú","Guichón","Quebracho","Piedras Coloradas"],"Río Negro":["Fray Bentos","Young","San Javier","Nuevo Berlín"],Rivera:["Rivera","Tranqueras","Vichadero","Minas de Corrales"],Rocha:["Rocha","Chuy","Castillos","Lascano","La Paloma","La Pedrera"],Salto:["Salto","Constitución","Belén"],"San José":["San José de Mayo","Ciudad del Plata","Libertad","Ecilda Paullier","Rafael Perazza"],Soriano:["Mercedes","Dolores","Cardona","Palmitas"],Tacuarembó:["Tacuarembó","Paso de los Toros","San Gregorio de Polanco"],"Treinta y Tres":["Treinta y Tres","Vergara","Santa Clara de Olimar"]},de=m.reparto?b:g,he=$[m.departamento]||[],[pe,je]=o.useState([]),[ie,ye]=o.useState({tipo:"producto",promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""});o.useEffect(()=>{Re()},[]),o.useEffect(()=>{var t;(t=_.state)!=null&&t.openForm&&(O(!0),window.history.replaceState({},document.title))},[_]),o.useEffect(()=>{le&&E.forEach(t=>{a[t.id]||Ae(t.id)})},[le,E]),o.useEffect(()=>{m.reparto&&!b.includes(m.departamento)&&r({...m,departamento:"Montevideo",localidad:""})},[m.reparto]),o.useEffect(()=>{const t=$[m.departamento]||[];m.localidad&&!t.includes(m.localidad)&&r({...m,localidad:""})},[m.departamento]);const Re=async()=>{var t;try{const[S,U,K,xe,ue,ge]=await Promise.all([c.from("ventas").select("*, cliente:clientes(nombre), estado, reparto").order("fecha_venta",{ascending:!1}),c.from("clientes").select("*").eq("activo",!0),c.from("productos").select("*").eq("activo",!0),c.from("categorias").select("*").order("nombre"),c.from("promociones").select("*").eq("activo",!0).order("nombre"),c.from("empresas").select("id").limit(1).maybeSingle()]);if(S.error)throw S.error;if(U.error)throw U.error;if(K.error)throw K.error;if(xe.error)throw xe.error;if(ue.error)throw ue.error;if(ge.error)throw ge.error;B(S.data||[]),N(U.data||[]),w(K.data||[]),y(xe.data||[]),X(ue.data||[]),j(((t=ge.data)==null?void 0:t.id)||null)}catch(S){h(S.message)}finally{f(!1)}},Ae=async t=>{if(!a[t])try{const{data:S,error:U}=await c.from("detalle_ventas").select("*, producto:productos(codigo_producto, nombre, altura_m, largo_m, separacion_cm, subtipo, categoria:categorias(nombre))").eq("venta_id",t);if(U)throw U;V(K=>({...K,[t]:S||[]}))}catch(S){h(S.message)}},ve=async t=>{v===t?F(null):(F(t),await Ae(t))},Ie=t=>{if(ye({tipo:ie.tipo,promocion_id:"",categoria_id:t,subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),t){const S=[...new Set(D.filter(U=>U.categoria_id===t&&U.subtipo).map(U=>U.subtipo))].sort();A(S)}else A([]);u([])},Se=t=>{if(ye({...ie,subtipo:t,producto_id:"",cantidad:"",precio_unitario:""}),t){const S=D.filter(U=>U.categoria_id===ie.categoria_id&&U.subtipo===t);u(S)}else u([])},We=async()=>{if(ie.tipo==="promocion"){if(!ie.promocion_id){h("Seleccione una promoción");return}try{const{data:t,error:S}=await c.from("detalle_promociones").select("producto_id, cantidad").eq("promocion_id",ie.promocion_id);if(S)throw S;if(!t||t.length===0){h("La promoción no tiene productos asociados");return}const U=t.map(K=>{const xe=D.find(ue=>ue.id===K.producto_id);if(!xe||!xe.precio_venta)throw new Error("Producto sin precio de venta");return{producto_id:K.producto_id,cantidad:K.cantidad,precio_unitario:xe.precio_venta,subtotal_item:K.cantidad*xe.precio_venta}});je([...pe,...U]),h("")}catch(t){h(t.message);return}}else{if(!ie.producto_id||!ie.cantidad){h("Complete todos los campos del detalle");return}const t=D.find(xe=>xe.id===ie.producto_id);if(!t||!t.precio_venta){h("El producto seleccionado no tiene precio de venta");return}const S=parseFloat(ie.cantidad),U=t.precio_venta,K=S*U;je([...pe,{producto_id:ie.producto_id,cantidad:S,precio_unitario:U,subtotal_item:K}])}ye({tipo:"producto",promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),A([]),u([])},Ge=t=>{je(pe.filter((S,U)=>U!==t))},qe=()=>{const t=pe.reduce((K,xe)=>K+xe.subtotal_item,0),S=parseFloat(m.envio)||0,U=parseFloat(m.descuento)||0;return t+S-U},Dt=async t=>{if(t.preventDefault(),h(""),pe.length===0){h("Debe agregar al menos un producto a la venta");return}if(!H){h("No se pudo obtener la información de la empresa");return}if(m.reparto&&!P){h("Para ventas con reparto debe seleccionar una ubicación en el mapa");return}try{const S=new Date().toISOString().split("T")[0],{data:U,error:K}=await c.from("ventas").select("numero_venta").like("numero_venta",`V-${S}%`).order("numero_venta",{ascending:!1}).limit(1);if(K)throw K;let xe=1;if(U&&U.length>0){const Be=U[0].numero_venta.split("-");Be.length===5&&(xe=parseInt(Be[4])+1)}const ue=`V-${S}-${xe.toString().padStart(3,"0")}`,ge=pe.reduce((Be,ot)=>Be+ot.subtotal_item,0),fe=qe(),{envio_check:De,reparto:Ue,...Ye}=m,Ze={...Ye,numero_venta:ue,empresa_id:H,cliente_id:Ye.cliente_id||null,subtotal:ge,total:fe,envio:parseFloat(m.envio)||0,descuento:parseFloat(m.descuento)||0,latitud:(P==null?void 0:P.lat)||null,longitud:(P==null?void 0:P.lng)||null,reparto:Ue,estado:Ue?"pendiente":"completado"},{data:_e,error:Oe}=await c.from("ventas").insert([Ze]).select().single();if(Oe)throw Oe;const Xe=pe.map(Be=>({...Be,venta_id:_e.id,descuento_item:0})),{error:He}=await c.from("detalle_ventas").insert(Xe);if(He)throw He;gt(),Re()}catch(S){h(S.message)}},gt=()=>{r({numero_venta:"",cliente_id:"",fecha_venta:new Date().toISOString().split("T")[0],departamento:"Montevideo",localidad:"",direccion:"",envio:"",descuento:"",notas:"",envio_check:!1,reparto:!1}),je([]),ye({tipo:"producto",promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),A([]),u([]),W(null),l(!1),O(!1)},Tt=t=>{const S=D.find(K=>K.id===t);if(!S)return t;let U=`${S.codigo_producto} - ${S.nombre}`;return(S.altura_m||S.largo_m||S.separacion_cm)&&(U+=" (",S.altura_m&&(U+=`${S.altura_m}m`),S.largo_m&&(U+=` x ${S.largo_m}m`),S.separacion_cm&&(U+=` - ${S.separacion_cm}cm`),U+=")"),U},It=async t=>{var S;try{const{data:U,error:K}=await c.from("ventas").select("*, cliente:clientes(nombre, telefono)").eq("id",t.id).single();if(K)throw K;const{data:xe,error:ue}=await c.from("detalle_ventas").select("cantidad, precio_unitario, subtotal_item, producto:productos(codigo_producto, nombre, altura_m, largo_m, separacion_cm, subtipo, categoria:categorias(nombre))").eq("venta_id",t.id);if(ue)throw ue;const ge=vt(U,xe||[]),De=`boletas/${`${t.numero_venta.replace(/\//g,"-")}.pdf`}`,{error:Ue}=await c.storage.from("boletas").upload(De,ge,{contentType:"application/pdf",upsert:!0});if(Ue)throw Ue;const{data:Ye}=c.storage.from("boletas").getPublicUrl(De),Ze=Ye.publicUrl;let _e=`¡Hola! 👋

`;if(_e+=`Te envío la boleta de tu compra:

`,_e+=`💰 Total: $${t.total.toFixed(2)}

`,t.direccion||t.localidad){_e+="📍 Entrega: ";const He=t.direccion?t.direccion.split(",").map(qt=>qt.trim()):[],Be=He[0]||"",ot=He[1]||"";t.localidad&&(_e+=t.localidad),ot&&Be&&(t.localidad&&(_e+=", "),_e+=`${ot} ${Be}`),_e+=`

`}_e+=`¡Gracias por tu compra! 🙏

`,_e+=`Ver boleta:
`,_e+=Ze;const Oe=encodeURIComponent(_e);let Xe="";(S=U.cliente)!=null&&S.telefono?Xe=`https://api.whatsapp.com/send?phone=${U.cliente.telefono.replace(/\D/g,"")}&text=${Oe}`:Xe=`https://api.whatsapp.com/send?text=${Oe}`,window.open(Xe,"_blank")}catch(U){console.error("Error al compartir por WhatsApp:",U.message),h("Error al preparar el mensaje de WhatsApp: "+U.message)}},Mt=async t=>{try{const{data:S,error:U}=await c.from("ventas").select("*, cliente:clientes(nombre, telefono)").eq("id",t.id).single();if(U)throw U;const{data:K,error:xe}=await c.from("detalle_ventas").select("cantidad, precio_unitario, subtotal_item, producto:productos(codigo_producto, nombre, altura_m, largo_m, separacion_cm, subtipo, categoria:categorias(nombre))").eq("venta_id",t.id);if(xe)throw xe;const ue=vt(S,K||[]),ge=window.URL.createObjectURL(ue),fe=document.createElement("a");fe.href=ge,fe.download=`${t.numero_venta.replace(/\//g,"-")}.pdf`,document.body.appendChild(fe),fe.click(),document.body.removeChild(fe),window.URL.revokeObjectURL(ge)}catch(S){console.error("Error al descargar boleta:",S.message),h("Error al descargar la boleta: "+S.message)}},$t=async t=>{try{const{data:S,error:U}=await c.from("ventas").select("*").eq("id",t.id).single();if(U)throw U;n({cliente_id:S.cliente_id||"",fecha_venta:S.fecha_venta||"",departamento:S.departamento||"",localidad:S.localidad||"",direccion:S.direccion||"",envio:S.envio?String(S.envio):"",descuento:S.descuento?String(S.descuento):"",notas:S.notas||"",estado:S.estado||""}),se(t)}catch(S){h(S.message)}},Wt=async()=>{if(ae){h("");try{const t=parseFloat(re.envio)||0,S=parseFloat(re.descuento)||0,{data:U,error:K}=await c.from("detalle_ventas").select("subtotal_item").eq("venta_id",ae.id);if(K)throw K;const ue=(U||[]).reduce((fe,De)=>fe+(De.subtotal_item||0),0)+t-S,{error:ge}=await c.from("ventas").update({cliente_id:re.cliente_id||null,fecha_venta:re.fecha_venta,departamento:re.departamento,localidad:re.localidad,direccion:re.direccion,envio:re.envio||"0",descuento:S,notas:re.notas,estado:re.estado,total:ue}).eq("id",ae.id);if(ge)throw ge;se(null),Re()}catch(t){h(t.message)}}},Bt=async()=>{if(be){h("");try{const{error:t}=await c.from("detalle_ventas").delete().eq("venta_id",be.id);if(t)throw t;const{error:S}=await c.from("ventas").delete().eq("id",be.id);if(S)throw S;ze(null),V(U=>{const K={...U};return delete K[be.id],K}),Re()}catch(t){h(t.message)}}},Lt=re.departamento?$[re.departamento]||[]:[],Vt=s?$[s]||[]:[],ft=E.filter(t=>{var Ue,Ye,Ze,_e,Oe;const S=p.toLowerCase(),U=!p||t.numero_venta.toLowerCase().includes(S)||((Ye=(Ue=t.cliente)==null?void 0:Ue.nombre)==null?void 0:Ye.toLowerCase().includes(S))||((Ze=t.direccion)==null?void 0:Ze.toLowerCase().includes(S))||((_e=t.departamento)==null?void 0:_e.toLowerCase().includes(S))||((Oe=t.localidad)==null?void 0:Oe.toLowerCase().includes(S)),K=!z||t.estado===z,xe=!ce||t.cliente_id===ce,ue=!s||t.departamento===s,ge=!d||t.localidad===d;let fe=!0;L==="reparto"?fe=t.reparto===!0:L==="envio"?fe=t.reparto!==!0&&t.direccion!==null&&t.direccion!=="":L==="sin_envio"&&(fe=t.reparto!==!0&&(t.direccion===null||t.direccion===""));let De=!0;return le&&(De=(a[t.id]||[]).some(He=>He.producto_id===le)),U&&K&&xe&&De&&ue&&ge&&fe});return e.jsx(me,{children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Gestión de Ventas"}),e.jsx("p",{children:"Registra ventas y actualiza stock automáticamente"})]}),e.jsxs("button",{onClick:()=>O(!Q),className:"btn-primary",children:[e.jsx(Ne,{size:20}),"Nueva Venta"]})]}),x&&e.jsxs("div",{className:"error-alert",children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:x}),e.jsx("button",{onClick:()=>h(""),style:{marginLeft:"auto"},children:e.jsx(Te,{size:20})})]}),Q&&e.jsxs("div",{className:"form-card",children:[e.jsx("h2",{children:"Registrar Nueva Venta"}),e.jsxs("form",{onSubmit:Dt,children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Número Venta *"}),e.jsx("input",{type:"text",value:"",placeholder:"Se generará automáticamente",readOnly:!0,style:{backgroundColor:"#f5f5f5",cursor:"not-allowed"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cliente"}),e.jsxs("select",{value:m.cliente_id,onChange:t=>r({...m,cliente_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Sin cliente"}),R.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha Venta *"}),e.jsx("input",{type:"date",value:m.fecha_venta,onChange:t=>r({...m,fecha_venta:t.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",style:{display:"flex",alignItems:"center",gap:"2rem",paddingTop:"1.5rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",margin:0,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:m.envio_check,onChange:t=>r({...m,envio_check:t.target.checked,reparto:!1}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Envío"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",margin:0,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:m.reparto,onChange:t=>r({...m,reparto:t.target.checked,envio_check:!1,envio:t.target.checked?m.envio:""}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Reparto"})]})]}),(m.envio_check||m.reparto)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Departamento"}),e.jsx("select",{value:m.departamento,onChange:t=>r({...m,departamento:t.target.value}),children:de.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Localidad"}),e.jsxs("select",{value:m.localidad,onChange:t=>r({...m,localidad:t.target.value}),children:[e.jsx("option",{value:"",children:"Seleccione una localidad"}),he.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:["Dirección",m.reparto&&e.jsxs("button",{type:"button",onClick:()=>l(!i),style:{padding:"4px 8px",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px",backgroundColor:i?"#dc2626":"#2563eb",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:[e.jsx(Rt,{size:14}),i?"Ocultar Mapa":"Abrir Mapa"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:m.direccion,onChange:t=>r({...m,direccion:t.target.value}),placeholder:(m.reparto,"Ingrese la dirección"),style:{flex:1}}),m.reparto&&e.jsx("button",{type:"button",onClick:()=>{var t;if(m.direccion.trim()){const S=`${m.direccion}, ${m.localidad}, ${m.departamento}`;(t=ee.current)==null||t.buscarDireccion(S),i||l(!0)}},style:{padding:"8px 12px",display:"flex",alignItems:"center",gap:"4px",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:"Buscar dirección en el mapa",children:e.jsx(Ke,{size:16})})]}),m.reparto&&i&&e.jsx(st,{ref:ee,onLocationSelect:(t,S,U)=>{W({lat:t,lng:S}),r({...m,direccion:U})},initialPosition:P?[P.lat,P.lng]:void 0})]})]}),m.reparto&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Envío (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:m.envio,onChange:t=>r({...m,envio:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descuento (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:m.descuento,onChange:t=>r({...m,descuento:t.target.value})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notas"}),e.jsx("textarea",{value:m.notas,onChange:t=>r({...m,notas:t.target.value}),rows:2})]}),e.jsxs("div",{style:{marginTop:"2rem"},children:[e.jsx("h3",{style:{marginBottom:"1rem"},children:"Productos"}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"600"},children:"Tipo de ítem"}),e.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",value:"producto",checked:ie.tipo==="producto",onChange:t=>ye({tipo:t.target.value,promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Producto Individual"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",value:"promocion",checked:ie.tipo==="promocion",onChange:t=>ye({tipo:t.target.value,promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Promoción/Combo"})]})]})]}),ie.tipo==="promocion"?e.jsx("div",{style:{marginBottom:"1rem"},children:e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Seleccionar Promoción"}),e.jsxs("select",{value:ie.promocion_id,onChange:t=>ye({...ie,promocion_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Seleccionar promoción..."}),G.map(t=>e.jsxs("option",{value:t.id,children:[t.nombre," - $",t.precio_total.toFixed(2)]},t.id))]}),ie.promocion_id&&e.jsx("small",{style:{color:"#6b7280",fontSize:"0.85rem",marginTop:"0.25rem",display:"block"},children:"Esta promoción agregará todos sus productos automáticamente"})]})}):e.jsxs("div",{className:"form-grid",style:{marginBottom:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Categoría"}),e.jsxs("select",{value:ie.categoria_id,onChange:t=>Ie(t.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar categoría..."}),M.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Subtipo"}),e.jsxs("select",{value:ie.subtipo,onChange:t=>Se(t.target.value),disabled:!ie.categoria_id,children:[e.jsx("option",{value:"",children:"Seleccionar subtipo..."}),I.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Producto"}),e.jsxs("select",{value:ie.producto_id,onChange:t=>ye({...ie,producto_id:t.target.value}),disabled:!ie.subtipo,children:[e.jsx("option",{value:"",children:"Seleccionar producto..."}),q.map(t=>{let S="";t.altura_m&&(S+=`${t.altura_m}m`),t.largo_m&&(S+=` x ${t.largo_m}m`),t.separacion_cm&&(S+=` - ${t.separacion_cm}cm`);const U=t.precio_venta?` - $${Number(t.precio_venta).toFixed(2)}`:"";return e.jsx("option",{value:t.id,children:(S||"Sin medidas")+U},t.id)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cantidad"}),e.jsx("input",{type:"number",step:"0.01",value:ie.cantidad,onChange:t=>ye({...ie,cantidad:t.target.value})})]})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end",marginBottom:"1rem"},children:e.jsx("button",{type:"button",onClick:We,className:"btn-secondary",children:ie.tipo==="promocion"?"Agregar Promoción":"Agregar Producto"})}),pe.length>0&&e.jsx("div",{className:"table-container",style:{marginTop:"1rem"},children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Precio Unit."}),e.jsx("th",{children:"Subtotal"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[pe.map((t,S)=>e.jsxs("tr",{children:[e.jsx("td",{children:Tt(t.producto_id)}),e.jsx("td",{children:t.cantidad}),e.jsxs("td",{children:["$",t.precio_unitario.toFixed(2)]}),e.jsxs("td",{children:["$",t.subtotal_item.toFixed(2)]}),e.jsx("td",{children:e.jsx("button",{type:"button",onClick:()=>Ge(S),className:"btn-icon delete",children:e.jsx(Ee,{size:16})})})]},S)),e.jsxs("tr",{style:{fontWeight:"bold"},children:[e.jsx("td",{colSpan:3,style:{textAlign:"right"},children:"TOTAL:"}),e.jsxs("td",{colSpan:2,children:["$",qe().toFixed(2)]})]})]})]})})]}),e.jsxs("div",{className:"form-actions",style:{marginTop:"2rem"},children:[e.jsx("button",{type:"submit",className:"btn-primary",children:"Registrar Venta"}),e.jsx("button",{type:"button",onClick:gt,className:"btn-secondary",children:"Cancelar"})]})]})]}),e.jsxs("div",{style:{background:"white",padding:"20px",borderRadius:"12px",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",marginBottom:"20px"},children:[e.jsx("h3",{style:{marginBottom:"16px",fontSize:"18px",fontWeight:"600"},children:"Buscar y Filtrar"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"16px"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ke,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#6b7280"}}),e.jsx("input",{type:"text",placeholder:"Buscar por número, cliente, dirección...",value:p,onChange:t=>T(t.target.value),style:{width:"100%",padding:"10px 10px 10px 40px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none"}})]}),e.jsxs("select",{value:z,onChange:t=>oe(t.target.value),style:{padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Todos los estados"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"completado",children:"Completado"})]}),e.jsxs("select",{value:ce,onChange:t=>J(t.target.value),style:{padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Todos los clientes"}),R.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]}),e.jsxs("select",{value:le,onChange:t=>te(t.target.value),style:{padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Todos los productos"}),D.map(t=>{let S=t.nombre,U="";return t.altura_m&&(U+=`${t.altura_m}m`),t.largo_m&&(U+=` x ${t.largo_m}m`),t.separacion_cm&&(U+=` - ${t.separacion_cm}cm`),U&&(S+=` (${U})`),t.precio_venta&&(S+=` - $${Number(t.precio_venta).toLocaleString("es-UY",{minimumFractionDigits:2,maximumFractionDigits:2})}`),e.jsx("option",{value:t.id,children:S},t.id)})]}),e.jsxs("select",{value:s,onChange:t=>{Y(t.target.value),C("")},style:{padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Todos los departamentos"}),g.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:d,onChange:t=>C(t.target.value),disabled:!s,style:{padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none",backgroundColor:"white",opacity:s?1:.5,cursor:s?"pointer":"not-allowed"},children:[e.jsx("option",{value:"",children:"Todas las localidades"}),Vt.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:L,onChange:t=>Z(t.target.value),style:{padding:"10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",outline:"none",backgroundColor:"white"},children:[e.jsx("option",{value:"",children:"Todos los tipos"}),e.jsx("option",{value:"reparto",children:"Reparto"}),e.jsx("option",{value:"envio",children:"Envío"}),e.jsx("option",{value:"sin_envio",children:"Sin Envío"})]})]}),(p||z||ce||le||s||d||L)&&e.jsx("button",{onClick:()=>{T(""),oe(""),J(""),te(""),Y(""),C(""),Z("")},style:{marginTop:"12px",padding:"8px 16px",background:"#ef4444",color:"white",border:"none",borderRadius:"6px",fontSize:"14px",cursor:"pointer",fontWeight:"600"},children:"Limpiar filtros"})]}),k?e.jsx("div",{className:"loading",children:"Cargando ventas..."}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Número"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Dirección"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Tipo"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Acciones"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:ft.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"empty-state",children:p||z||ce||le||s||d||L?"No se encontraron ventas con los filtros aplicados":"No hay ventas registradas"})}):ft.map(t=>{var S,U;return e.jsxs(o.Fragment,{children:[e.jsxs("tr",{style:{transition:"background-color 0.2s"},onMouseEnter:K=>{K.currentTarget.style.backgroundColor="#f1f5f9"},onMouseLeave:K=>{K.currentTarget.style.backgroundColor=""},children:[e.jsx("td",{onClick:()=>ve(t.id),style:{cursor:"pointer"},children:t.numero_venta}),e.jsx("td",{onClick:()=>ve(t.id),style:{cursor:"pointer"},children:((S=t.cliente)==null?void 0:S.nombre)||"Sin cliente"}),e.jsx("td",{onClick:()=>ve(t.id),style:{cursor:"pointer"},children:t.localidad||t.departamento?e.jsxs(e.Fragment,{children:[t.localidad&&`${t.localidad}, `,t.departamento,t.direccion&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:t.direccion})]})]}):"-"}),e.jsx("td",{onClick:()=>ve(t.id),style:{cursor:"pointer"},children:new Date(t.fecha_venta).toLocaleDateString()}),e.jsx("td",{onClick:()=>ve(t.id),style:{cursor:"pointer"},children:e.jsx("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"0.85rem",fontWeight:"500",backgroundColor:t.estado==="completado"?"#dcfce7":t.estado==="pendiente"?"#fef3c7":"#e5e7eb",color:t.estado==="completado"?"#16a34a":t.estado==="pendiente"?"#ca8a04":"#6b7280"},children:t.estado==="completado"?"Completado":t.estado==="pendiente"?"Pendiente":"Sin estado"})}),e.jsx("td",{onClick:()=>ve(t.id),style:{cursor:"pointer"},children:e.jsx("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"0.85rem",fontWeight:"500",backgroundColor:t.reparto?"#dbeafe":"#f3f4f6",color:t.reparto?"#2563eb":"#6b7280"},children:t.reparto?"Reparto":"Envío"})}),e.jsxs("td",{onClick:()=>ve(t.id),style:{cursor:"pointer"},children:["$",((U=t.total)==null?void 0:U.toFixed(2))||"0.00"]}),e.jsx("td",{style:{textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:K=>{K.stopPropagation(),$t(t)},style:{padding:"0.5rem",backgroundColor:"#fef3c7",color:"#b45309",border:"none",borderRadius:"6px",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center"},title:"Editar venta",children:e.jsx(fr,{size:16})}),e.jsx("button",{onClick:K=>{K.stopPropagation(),ze(t)},style:{padding:"0.5rem",backgroundColor:"#fee2e2",color:"#dc2626",border:"none",borderRadius:"6px",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center"},title:"Eliminar venta",children:e.jsx(Ee,{size:16})}),e.jsx("button",{onClick:K=>{K.stopPropagation(),It(t)},style:{padding:"0.5rem",backgroundColor:"#dcfce7",color:"#16a34a",border:"none",borderRadius:"6px",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center"},title:"Compartir por WhatsApp",children:e.jsx(Pt,{size:16})}),e.jsx("button",{onClick:K=>{K.stopPropagation(),Mt(t)},style:{padding:"0.5rem",backgroundColor:"#dbeafe",color:"#2563eb",border:"none",borderRadius:"6px",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center"},title:"Descargar Boleta PDF",children:e.jsx(xr,{size:16})})]})}),e.jsx("td",{onClick:()=>ve(t.id),style:{textAlign:"center",cursor:"pointer"},children:v===t.id?e.jsx(pr,{size:20,color:"#64748b"}):e.jsx(ur,{size:20,color:"#64748b"})})]}),v===t.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{padding:0,backgroundColor:"#f8fafc"},children:e.jsxs("div",{style:{padding:"1rem 2rem"},children:[e.jsx("h4",{style:{marginBottom:"0.5rem",color:"#1e293b"},children:"Detalle de Productos"}),a[t.id]?a[t.id].length===0?e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"#64748b",backgroundColor:"white",borderRadius:"4px"},children:"Esta venta no tiene productos asociados"}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",backgroundColor:"white"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#e2e8f0"},children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left",border:"1px solid #cbd5e1"},children:"Producto"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center",border:"1px solid #cbd5e1"},children:"Cantidad"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",border:"1px solid #cbd5e1"},children:"Precio Unit."}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",border:"1px solid #cbd5e1"},children:"Subtotal"})]})}),e.jsx("tbody",{children:a[t.id].map((K,xe)=>{var fe,De;const ue=K.producto;let ge=ue?`${ue.codigo_producto} - ${ue.nombre}`:"Producto no encontrado";return ue&&(ue.altura_m||ue.largo_m||ue.separacion_cm)&&(ge+=" (",ue.altura_m&&(ge+=`${ue.altura_m}m`),ue.largo_m&&(ge+=` x ${ue.largo_m}m`),ue.separacion_cm&&(ge+=` - ${ue.separacion_cm}cm`),ge+=")"),e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.5rem",border:"1px solid #cbd5e1"},children:ge}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center",border:"1px solid #cbd5e1"},children:K.cantidad}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",border:"1px solid #cbd5e1"},children:["$",(fe=K.precio_unitario)==null?void 0:fe.toFixed(2)]}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",border:"1px solid #cbd5e1"},children:["$",(De=K.subtotal_item)==null?void 0:De.toFixed(2)]})]},xe)})})]}):e.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"#64748b"},children:"Cargando detalles..."})]})})})]},t.id)})})]})}),be&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",maxWidth:"450px",width:"90%"},children:[e.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1.25rem",color:"#1e293b"},children:"Confirmar eliminacion"}),e.jsxs("p",{style:{color:"#64748b",marginBottom:"1.5rem"},children:["Esta seguro que desea eliminar la venta ",e.jsx("strong",{children:be.numero_venta}),"? Esta accion no se puede deshacer y se eliminaran todos los productos asociados."]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>ze(null),style:{padding:"0.6rem 1.2rem",backgroundColor:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsx("button",{onClick:Bt,style:{padding:"0.6rem 1.2rem",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Eliminar"})]})]})}),ae&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",maxWidth:"600px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("h3",{style:{margin:0,fontSize:"1.25rem",color:"#1e293b"},children:["Editar Venta - ",ae.numero_venta]}),e.jsx("button",{onClick:()=>se(null),style:{padding:"4px",backgroundColor:"transparent",border:"none",cursor:"pointer",color:"#6b7280"},children:e.jsx(Te,{size:24})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cliente"}),e.jsxs("select",{value:re.cliente_id,onChange:t=>n({...re,cliente_id:t.target.value}),children:[e.jsx("option",{value:"",children:"Sin cliente"}),R.map(t=>e.jsx("option",{value:t.id,children:t.nombre},t.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha Venta"}),e.jsx("input",{type:"date",value:re.fecha_venta,onChange:t=>n({...re,fecha_venta:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:re.estado,onChange:t=>n({...re,estado:t.target.value}),children:[e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"completado",children:"Completado"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Departamento"}),e.jsxs("select",{value:re.departamento,onChange:t=>n({...re,departamento:t.target.value,localidad:""}),children:[e.jsx("option",{value:"",children:"Sin departamento"}),g.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Localidad"}),e.jsxs("select",{value:re.localidad,onChange:t=>n({...re,localidad:t.target.value}),disabled:!re.departamento,children:[e.jsx("option",{value:"",children:"Sin localidad"}),Lt.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Direccion"}),e.jsx("input",{type:"text",value:re.direccion,onChange:t=>n({...re,direccion:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Envio (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:re.envio,onChange:t=>n({...re,envio:t.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descuento (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:re.descuento,onChange:t=>n({...re,descuento:t.target.value})})]})]}),e.jsxs("div",{className:"form-group",style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Notas"}),e.jsx("textarea",{value:re.notas,onChange:t=>n({...re,notas:t.target.value}),rows:2})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end",marginTop:"1.5rem"},children:[e.jsx("button",{onClick:()=>se(null),style:{padding:"0.6rem 1.2rem",backgroundColor:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsx("button",{onClick:Wt,style:{padding:"0.6rem 1.2rem",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Guardar Cambios"})]})]})})]})})}function zr(){const _=rt(),[E,B]=o.useState([]),[R,N]=o.useState([]),[D,w]=o.useState([]),[G,X]=o.useState([]),[M,y]=o.useState([]),[I,A]=o.useState([]),[q,u]=o.useState(!0),[k,f]=o.useState(""),[Q,O]=o.useState(""),[x,h]=o.useState(!1),[i,l]=o.useState(null),P=o.useRef(null),[W,ee]=o.useState(null),[H,j]=o.useState(!1),[v,F]=o.useState({nombre:"",telefono:"",direccion:""}),[a,V]=o.useState({numero_venta:"",cliente_id:"",fecha_venta:new Date().toISOString().split("T")[0],departamento:"Montevideo",localidad:"",direccion:"",envio:"",descuento:"",notas:"",envio_check:!1,reparto:!1}),p=["Artigas","Canelones","Cerro Largo","Colonia","Durazno","Flores","Florida","Lavalleja","Maldonado","Montevideo","Paysandú","Río Negro","Rivera","Rocha","Salto","San José","Soriano","Tacuarembó","Treinta y Tres"],T=["Canelones","Colonia","Maldonado","Montevideo","San José"],z={Artigas:["Artigas","Bella Unión","Tomás Gomensoro","Baltasar Brum"],Canelones:["Canelones","Ciudad de la Costa","Las Piedras","Pando","La Paz","Progreso","Santa Lucía","Atlántida","Parque del Plata"],"Cerro Largo":["Melo","Río Branco","Fraile Muerto","Aceguá"],Colonia:["Colonia del Sacramento","Carmelo","Nueva Helvecia","Juan Lacaze","Rosario","Tarariras"],Durazno:["Durazno","Sarandí del Yí","Villa del Carmen"],Flores:["Trinidad","Ismael Cortinas"],Florida:["Florida","Sarandí Grande","Fray Marcos","25 de Agosto"],Lavalleja:["Minas","José Pedro Varela","Solís de Mataojo"],Maldonado:["Maldonado","Punta del Este","San Carlos","Pan de Azúcar","Piriápolis"],Montevideo:["Montevideo","Ciudad Vieja","Centro","Cordón","Parque Rodó","Pocitos","Buceo","Carrasco","Malvín","Punta Carretas"],Paysandú:["Paysandú","Guichón","Quebracho","Piedras Coloradas"],"Río Negro":["Fray Bentos","Young","San Javier","Nuevo Berlín"],Rivera:["Rivera","Tranqueras","Vichadero","Minas de Corrales"],Rocha:["Rocha","Chuy","Castillos","Lascano","La Paloma","La Pedrera"],Salto:["Salto","Constitución","Belén"],"San José":["San José de Mayo","Ciudad del Plata","Libertad","Ecilda Paullier","Rafael Perazza"],Soriano:["Mercedes","Dolores","Cardona","Palmitas"],Tacuarembó:["Tacuarembó","Paso de los Toros","San Gregorio de Polanco"],"Treinta y Tres":["Treinta y Tres","Vergara","Santa Clara de Olimar"]},oe=a.reparto?T:p,le=z[a.departamento]||[],[te,ce]=o.useState([]),[J,s]=o.useState({tipo:"producto",promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""});o.useEffect(()=>{Y()},[]),o.useEffect(()=>{a.reparto&&!T.includes(a.departamento)&&V({...a,departamento:"Montevideo",localidad:""})},[a.reparto]),o.useEffect(()=>{const n=z[a.departamento]||[];a.localidad&&!n.includes(a.localidad)&&V({...a,localidad:""})},[a.departamento]);const Y=async()=>{var n;try{const[m,r,g,b,$]=await Promise.all([c.from("clientes").select("*").eq("activo",!0),c.from("productos").select("*").eq("activo",!0),c.from("categorias").select("*").order("nombre"),c.from("promociones").select("*").eq("activo",!0).order("nombre"),c.from("empresas").select("id").limit(1).maybeSingle()]);if(m.error)throw m.error;if(r.error)throw r.error;if(g.error)throw g.error;if(b.error)throw b.error;if($.error)throw $.error;B(m.data||[]),N(r.data||[]),X(g.data||[]),w(b.data||[]),ee(((n=$.data)==null?void 0:n.id)||null)}catch(m){f(m.message)}finally{u(!1)}},d=n=>{if(s({tipo:J.tipo,promocion_id:"",categoria_id:n,subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),n){const m=[...new Set(R.filter(r=>r.categoria_id===n&&r.subtipo).map(r=>r.subtipo))].sort();y(m)}else y([]);A([])},C=n=>{if(s({...J,subtipo:n,producto_id:"",cantidad:"",precio_unitario:""}),n){const m=R.filter(r=>r.categoria_id===J.categoria_id&&r.subtipo===n);A(m)}else A([])},L=async()=>{if(!v.nombre.trim()){f("El nombre del cliente es requerido");return}if(!W){f("No se pudo obtener la empresa");return}try{const{data:n,error:m}=await c.from("clientes").insert({empresa_id:W,nombre:v.nombre,telefono:v.telefono||null,direccion:v.direccion||null,activo:!0}).select().single();if(m)throw m;B([...E,n]),V({...a,cliente_id:n.id}),F({nombre:"",telefono:"",direccion:""}),j(!1),O("Cliente agregado exitosamente"),setTimeout(()=>O(""),3e3)}catch(n){f(n.message)}},Z=async()=>{if(J.tipo==="promocion"){if(!J.promocion_id){f("Seleccione una promoción");return}try{const{data:n,error:m}=await c.from("detalle_promociones").select("producto_id, cantidad").eq("promocion_id",J.promocion_id);if(m)throw m;if(!n||n.length===0){f("La promoción no tiene productos asociados");return}const r=n.map(g=>{const b=R.find($=>$.id===g.producto_id);if(!b||!b.precio_venta)throw new Error("Producto sin precio de venta");return{producto_id:g.producto_id,cantidad:g.cantidad,precio_unitario:b.precio_venta,subtotal_item:g.cantidad*b.precio_venta}});ce([...te,...r]),f("")}catch(n){f(n.message);return}}else{if(!J.producto_id||!J.cantidad){f("Complete todos los campos del detalle");return}const n=R.find(b=>b.id===J.producto_id);if(!n||!n.precio_venta){f("El producto seleccionado no tiene precio de venta");return}const m=parseFloat(J.cantidad),r=n.precio_venta,g=m*r;ce([...te,{producto_id:J.producto_id,cantidad:m,precio_unitario:r,subtotal_item:g}])}s({tipo:"producto",promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),y([]),A([]),f("")},ae=n=>{ce(te.filter((m,r)=>r!==n))},se=()=>{const n=te.reduce((g,b)=>g+b.subtotal_item,0),m=parseFloat(a.envio)||0,r=parseFloat(a.descuento)||0;return n+m-r},be=async n=>{if(n.preventDefault(),f(""),O(""),te.length===0){f("Debe agregar al menos un producto a la venta");return}if(!W){f("No se pudo obtener la información de la empresa");return}if(a.reparto&&!i){f("Para ventas con reparto debe seleccionar una ubicación en el mapa");return}try{const m=new Date().toISOString().split("T")[0],{data:r,error:g}=await c.from("ventas").select("numero_venta").like("numero_venta",`V-${m}%`).order("numero_venta",{ascending:!1}).limit(1);if(g)throw g;let b=1;if(r&&r.length>0){const Se=r[0].numero_venta.split("-");Se.length===5&&(b=parseInt(Se[4])+1)}const $=`V-${m}-${b.toString().padStart(3,"0")}`,de=te.reduce((Se,We)=>Se+We.subtotal_item,0),he=se(),{envio_check:pe,reparto:je,...ie}=a,ye={...ie,numero_venta:$,empresa_id:W,cliente_id:ie.cliente_id||null,subtotal:de,total:he,envio:parseFloat(a.envio)||0,descuento:parseFloat(a.descuento)||0,latitud:(i==null?void 0:i.lat)||null,longitud:(i==null?void 0:i.lng)||null,reparto:je,estado:je?"pendiente":"completado"},{data:Re,error:Ae}=await c.from("ventas").insert([ye]).select().single();if(Ae)throw Ae;const ve=te.map(Se=>({...Se,venta_id:Re.id,descuento_item:0})),{error:Ie}=await c.from("detalle_ventas").insert(ve);if(Ie)throw Ie;O(`Venta registrada exitosamente: ${$}`),ze(),setTimeout(()=>{_("/dashboard")},2e3)}catch(m){f(m.message)}},ze=()=>{V({numero_venta:"",cliente_id:"",fecha_venta:new Date().toISOString().split("T")[0],departamento:"Montevideo",localidad:"",direccion:"",envio:"",descuento:"",notas:"",envio_check:!1,reparto:!1}),ce([]),s({tipo:"producto",promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),y([]),A([]),l(null),h(!1)},re=n=>{const m=R.find(g=>g.id===n);if(!m)return n;let r=`${m.codigo_producto} - ${m.nombre}`;return(m.altura_m||m.largo_m||m.separacion_cm)&&(r+=" (",m.altura_m&&(r+=`${m.altura_m}m`),m.largo_m&&(r+=` x ${m.largo_m}m`),m.separacion_cm&&(r+=` - ${m.separacion_cm}cm`),r+=")"),r};return q?e.jsx(me,{children:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("div",{className:"loading",children:"Cargando..."})})}):e.jsx(me,{children:e.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #16a34a 0%, #15803d 100%)",padding:"2rem",color:"white"},children:[e.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"700"},children:"Nueva Venta"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",opacity:.9},children:"Complete los datos para registrar una nueva venta"})]}),e.jsxs("div",{style:{padding:"2rem"},children:[k&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:k})]}),Q&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:Q})]}),H&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"2rem",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.5rem",fontWeight:"600"},children:"Agregar Nuevo Cliente"}),e.jsx("button",{type:"button",onClick:()=>j(!1),style:{padding:"4px",display:"flex",alignItems:"center",backgroundColor:"transparent",color:"#6b7280",border:"none",cursor:"pointer"},children:e.jsx(Te,{size:24})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{type:"text",value:v.nombre,onChange:n=>F({...v,nombre:n.target.value}),placeholder:"Nombre del cliente"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Teléfono"}),e.jsx("input",{type:"text",value:v.telefono,onChange:n=>F({...v,telefono:n.target.value}),placeholder:"Teléfono del cliente"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Dirección"}),e.jsx("input",{type:"text",value:v.direccion,onChange:n=>F({...v,direccion:n.target.value}),placeholder:"Dirección del cliente"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsx("button",{type:"button",onClick:L,style:{flex:1,padding:"0.75rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"600"},children:"Guardar Cliente"}),e.jsx("button",{type:"button",onClick:()=>j(!1),style:{flex:1,padding:"0.75rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"})]})]})]})}),e.jsxs("form",{onSubmit:be,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Número Venta"}),e.jsx("input",{type:"text",value:"",placeholder:"Se generará automáticamente",readOnly:!0,style:{backgroundColor:"#f5f5f5",cursor:"not-allowed"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cliente"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("select",{value:a.cliente_id,onChange:n=>{const m=n.target.value,r=E.find(g=>g.id===m);V({...a,cliente_id:m,direccion:(r==null?void 0:r.direccion)||a.direccion})},style:{flex:1},children:[e.jsx("option",{value:"",children:"Sin cliente"}),E.map(n=>e.jsx("option",{value:n.id,children:n.nombre},n.id))]}),e.jsx("button",{type:"button",onClick:()=>{F({nombre:"",telefono:"",direccion:a.direccion||""}),j(!0)},style:{padding:"8px 12px",display:"flex",alignItems:"center",gap:"4px",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:"Agregar nuevo cliente",children:e.jsx(At,{size:16})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha Venta *"}),e.jsx("input",{type:"date",value:a.fecha_venta,onChange:n=>V({...a,fecha_venta:n.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",style:{display:"flex",alignItems:"center",gap:"2rem",paddingTop:"1.5rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",margin:0,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:a.envio_check,onChange:n=>V({...a,envio_check:n.target.checked,reparto:!1}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Envío"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",margin:0,cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:a.reparto,onChange:n=>V({...a,reparto:n.target.checked,envio_check:!1,envio:n.target.checked?a.envio:""}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Reparto"})]})]}),(a.envio_check||a.reparto)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Departamento"}),e.jsx("select",{value:a.departamento,onChange:n=>V({...a,departamento:n.target.value}),children:oe.map(n=>e.jsx("option",{value:n,children:n},n))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Localidad"}),e.jsxs("select",{value:a.localidad,onChange:n=>V({...a,localidad:n.target.value}),children:[e.jsx("option",{value:"",children:"Seleccione una localidad"}),le.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:["Dirección",a.reparto&&e.jsxs("button",{type:"button",onClick:()=>h(!x),style:{padding:"4px 8px",fontSize:"12px",display:"flex",alignItems:"center",gap:"4px",backgroundColor:x?"#dc2626":"#2563eb",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:[e.jsx(Rt,{size:14}),x?"Ocultar Mapa":"Abrir Mapa"]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("input",{type:"text",value:a.direccion,onChange:n=>V({...a,direccion:n.target.value}),placeholder:"Ingrese la dirección",style:{flex:1}}),a.reparto&&e.jsx("button",{type:"button",onClick:()=>{var n;if(a.direccion.trim()){const m=`${a.direccion}, ${a.localidad}, ${a.departamento}`;(n=P.current)==null||n.buscarDireccion(m),x||h(!0)}},style:{padding:"8px 12px",display:"flex",alignItems:"center",gap:"4px",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:"Buscar dirección en el mapa",children:e.jsx(Ke,{size:16})})]}),a.reparto&&x&&e.jsx(st,{ref:P,onLocationSelect:(n,m,r)=>{l({lat:n,lng:m}),V({...a,direccion:r})},initialPosition:i?[i.lat,i.lng]:void 0})]})]}),a.reparto&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Envío (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:a.envio,onChange:n=>V({...a,envio:n.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descuento (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:a.descuento,onChange:n=>V({...a,descuento:n.target.value})})]})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsx("label",{children:"Notas"}),e.jsx("textarea",{value:a.notas,onChange:n=>V({...a,notas:n.target.value}),rows:2})]}),e.jsxs("div",{style:{background:"#f8fafc",padding:"2rem",borderRadius:"12px",marginBottom:"2rem"},children:[e.jsx("h3",{style:{margin:"0 0 1.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Productos"}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"600"},children:"Tipo de ítem"}),e.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",value:"producto",checked:J.tipo==="producto",onChange:n=>s({tipo:n.target.value,promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Producto Individual"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",value:"promocion",checked:J.tipo==="promocion",onChange:n=>s({tipo:n.target.value,promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Promoción/Combo"})]})]})]}),J.tipo==="promocion"?e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Seleccionar Promoción"}),e.jsxs("select",{value:J.promocion_id,onChange:n=>s({...J,promocion_id:n.target.value}),children:[e.jsx("option",{value:"",children:"Seleccionar promoción..."}),D.map(n=>e.jsxs("option",{value:n.id,children:[n.nombre," - $",n.precio_total.toFixed(2)]},n.id))]}),J.promocion_id&&e.jsx("small",{style:{color:"#6b7280",fontSize:"0.85rem",marginTop:"0.25rem",display:"block"},children:"Esta promoción agregará todos sus productos automáticamente"})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end",marginTop:"1rem"},children:e.jsxs("button",{type:"button",onClick:Z,style:{width:"100%",padding:"0.75rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(Ne,{size:20}),"Agregar Promoción"]})})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Categoría"}),e.jsxs("select",{value:J.categoria_id,onChange:n=>d(n.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar categoría..."}),G.map(n=>e.jsx("option",{value:n.id,children:n.nombre},n.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Subtipo"}),e.jsxs("select",{value:J.subtipo,onChange:n=>C(n.target.value),disabled:!J.categoria_id,children:[e.jsx("option",{value:"",children:"Seleccionar subtipo..."}),M.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Producto"}),e.jsxs("select",{value:J.producto_id,onChange:n=>s({...J,producto_id:n.target.value}),disabled:!J.subtipo,children:[e.jsx("option",{value:"",children:"Seleccionar producto..."}),I.map(n=>{let m="";n.altura_m&&(m+=`${n.altura_m}m`),n.largo_m&&(m+=` x ${n.largo_m}m`),n.separacion_cm&&(m+=` - ${n.separacion_cm}cm`);const r=n.precio_venta?` - $${Number(n.precio_venta).toFixed(2)}`:"";return e.jsx("option",{value:n.id,children:(m||"Sin medidas")+r},n.id)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cantidad"}),e.jsx("input",{type:"number",step:"0.01",value:J.cantidad,onChange:n=>s({...J,cantidad:n.target.value})})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsxs("button",{type:"button",onClick:Z,style:{width:"100%",padding:"0.75rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(Ne,{size:20}),"Agregar"]})})]})}),te.length>0&&e.jsx("div",{style:{background:"white",borderRadius:"8px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f1f5f9"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Producto"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600"},children:"Cantidad"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Precio Unit."}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Subtotal"}),e.jsx("th",{style:{padding:"0.75rem",width:"50px"}})]})}),e.jsxs("tbody",{children:[te.map((n,m)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:re(n.producto_id)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:n.cantidad}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right"},children:["$",n.precio_unitario.toFixed(2)]}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right"},children:["$",n.subtotal_item.toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:e.jsx("button",{type:"button",onClick:()=>ae(m),style:{padding:"0.5rem",backgroundColor:"#fee2e2",color:"#dc2626",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ee,{size:16})})})]},m)),e.jsxs("tr",{style:{background:"#f8fafc",fontWeight:"700",fontSize:"1.1rem"},children:[e.jsx("td",{colSpan:3,style:{padding:"1rem",textAlign:"right"},children:"TOTAL:"}),e.jsxs("td",{colSpan:2,style:{padding:"1rem",textAlign:"right",color:"#16a34a"},children:["$",se().toFixed(2)]})]})]})]})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>_("/dashboard"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 2rem",backgroundColor:"#16a34a",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:"Registrar Venta"})]})]})]})]})})})}const Me={lat:-34.8705,lng:-56.2208},Rr=13,Je=[{value:"pendiente",label:"Pendiente",color:"#94a3b8"},{value:"pagado",label:"Pagado",color:"#3b82f6"},{value:"en_reparto",label:"En Reparto",color:"#f59e0b"},{value:"enviado",label:"Enviado",color:"#8b5cf6"},{value:"entregado",label:"Entregado",color:"#10b981"},{value:"completado",label:"Completado",color:"#059669"}],pt=(_,E,B,R)=>{const D=(B-_)*Math.PI/180,w=(R-E)*Math.PI/180,G=Math.sin(D/2)*Math.sin(D/2)+Math.cos(_*Math.PI/180)*Math.cos(B*Math.PI/180)*Math.sin(w/2)*Math.sin(w/2);return 6371*(2*Math.atan2(Math.sqrt(G),Math.sqrt(1-G)))},Pr=_=>{if(_.length<=1)return _;const E=[],B=[..._];let R=Me;for(;B.length>0;){let N=0,D=1/0;B.forEach((G,X)=>{const M=pt(R.lat,R.lng,G.latitud,G.longitud);M<D&&(D=M,N=X)});const w=B.splice(N,1)[0];E.push(w),R={lat:w.latitud,lng:w.longitud}}return E},Fr=_=>{const E=Je.find(R=>R.value===_),B=(E==null?void 0:E.color)||"#94a3b8";return new it.Icon({iconUrl:`data:image/svg+xml;base64,${btoa(`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${B}" width="36" height="36">
        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
      </svg>
    `)}`,iconSize:[36,36],iconAnchor:[18,36],popupAnchor:[0,-36]})},Er=()=>new it.Icon({iconUrl:`data:image/svg+xml;base64,${btoa(`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#ef4444" width="40" height="40">
        <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
      </svg>
    `)}`,iconSize:[40,40],iconAnchor:[20,40],popupAnchor:[0,-40]});function Ar(){const[_,E]=o.useState([]),[B,R]=o.useState([]),[N,D]=o.useState(!0),[w,G]=o.useState(new Date().toISOString().split("T")[0]),[X,M]=o.useState("todos"),[y,I]=o.useState({});o.useEffect(()=>{A()},[w,X]),o.useEffect(()=>{if(_.length>0){const x=Pr(_);R(x)}else R([])},[_]);const A=async()=>{try{D(!0);let x=c.from("ventas").select("*, cliente:clientes(nombre)").eq("reparto",!0).eq("fecha_venta",w).not("latitud","is",null).not("longitud","is",null).order("estado");X!=="todos"&&(x=x.eq("estado",X));const{data:h,error:i}=await x;if(i)throw i;if(E(h||[]),h&&h.length>0){const l=h.map(P=>P.id);q(l)}}catch(x){console.error("Error al cargar ventas de reparto:",x)}finally{D(!1)}},q=async x=>{try{const{data:h,error:i}=await c.from("detalle_ventas").select("*, producto:productos(codigo_producto, nombre, altura_m, largo_m, separacion_cm)").in("venta_id",x);if(i)throw i;const l={};x.forEach(P=>{l[P]=[]}),h==null||h.forEach(P=>{l[P.venta_id]&&l[P.venta_id].push(P)}),I(l)}catch(h){console.error("Error al cargar detalles de ventas:",h)}},u=async(x,h)=>{try{const{error:i}=await c.from("ventas").update({estado:h,actualizado_en:new Date().toISOString()}).eq("id",x);if(i)throw i;E(l=>l.map(P=>P.id===x?{...P,estado:h}:P))}catch(i){console.error("Error al actualizar estado:",i),alert("Error al actualizar el estado")}},k=[Me.lat,Me.lng],f=[[Me.lat,Me.lng],...B.map(x=>[x.latitud,x.longitud])],Q=()=>{if(B.length===0)return 0;let x=0,h=Me;return B.forEach(i=>{x+=pt(h.lat,h.lng,i.latitud,i.longitud),h={lat:i.latitud,lng:i.longitud}}),x+=pt(h.lat,h.lng,Me.lat,Me.lng),x},O=x=>Je.find(h=>h.value===x)||Je[0];return e.jsx(me,{children:e.jsxs("div",{className:"page-container",children:[e.jsx("div",{className:"page-header",children:e.jsxs("h1",{children:[e.jsx(Ft,{size:32}),"Rutas de Reparto"]})}),e.jsxs("div",{className:"filters-container",style:{marginBottom:"1rem"},children:[e.jsxs("div",{className:"form-group",style:{marginBottom:0},children:[e.jsx("label",{children:"Fecha"}),e.jsx("input",{type:"date",value:w,onChange:x=>G(x.target.value)})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:0},children:[e.jsx("label",{children:"Estado"}),e.jsxs("select",{value:X,onChange:x=>M(x.target.value),children:[e.jsx("option",{value:"todos",children:"Todos los estados"}),Je.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))]})]})]}),N?e.jsx("p",{children:"Cargando rutas..."}):_.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#64748b",backgroundColor:"#f8fafc",borderRadius:"8px",border:"1px dashed #cbd5e1"},children:[e.jsx($e,{size:48,style:{margin:"0 auto 1rem"}}),e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:"No hay pedidos de reparto para esta fecha"}),e.jsx("p",{style:{fontSize:"0.9rem"},children:"Selecciona otra fecha o cambia los filtros"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",gap:"1rem",flexWrap:"wrap",padding:"1rem",backgroundColor:"#f8fafc",borderRadius:"8px"},children:[e.jsxs("div",{style:{fontSize:"0.9rem",color:"#475569"},children:[e.jsx("strong",{children:"Total de pedidos:"})," ",_.length]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#475569"},children:[e.jsx("strong",{children:"Distancia total:"})," ",Q().toFixed(2)," km"]}),e.jsxs("div",{style:{fontSize:"0.9rem",color:"#475569"},children:[e.jsx("strong",{children:"Combustible necesario:"})," ",(Q()/Rr).toFixed(2)," litros"]}),Je.map(x=>{const h=_.filter(i=>i.estado===x.value).length;return h===0?null:e.jsxs("div",{style:{fontSize:"0.9rem",color:"#475569"},children:[e.jsx("span",{style:{display:"inline-block",width:"12px",height:"12px",borderRadius:"50%",backgroundColor:x.color,marginRight:"0.5rem"}}),e.jsxs("strong",{children:[x.label,":"]})," ",h]},x.value)})]}),e.jsx("div",{style:{height:"500px",borderRadius:"8px",overflow:"hidden",marginBottom:"2rem",border:"1px solid #e2e8f0"},children:e.jsxs(St,{center:k,zoom:12,style:{height:"100%",width:"100%"},children:[e.jsx(wt,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(lt,{position:[Me.lat,Me.lng],icon:Er(),children:e.jsx(bt,{children:e.jsxs("div",{style:{minWidth:"200px"},children:[e.jsx("h3",{style:{margin:"0 0 0.5rem 0",fontSize:"1rem",color:"#1e293b",fontWeight:"bold"},children:"Punto de Partida"}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"#475569"},children:[e.jsxs("p",{style:{margin:"0.25rem 0"},children:[e.jsx("strong",{children:"Dirección:"})," Antonio Zubillaga 425"]}),e.jsx("p",{style:{margin:"0.25rem 0"},children:"La Teja, Montevideo"})]})]})})}),f.length>1&&e.jsx(Zt,{positions:f,color:"#3b82f6",weight:3,opacity:.7,dashArray:"10, 10"}),B.map((x,h)=>{var i;return e.jsx(lt,{position:[x.latitud,x.longitud],icon:Fr(x.estado),children:e.jsx(bt,{children:e.jsxs("div",{style:{minWidth:"250px",maxWidth:"350px"},children:[e.jsxs("h3",{style:{margin:"0 0 0.5rem 0",fontSize:"1rem",color:"#1e293b"},children:["Parada #",h+1," - ",x.numero_venta]}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"#475569"},children:[e.jsxs("p",{style:{margin:"0.25rem 0"},children:[e.jsx("strong",{children:"Cliente:"})," ",((i=x.cliente)==null?void 0:i.nombre)||"Sin cliente"]}),e.jsxs("p",{style:{margin:"0.25rem 0"},children:[e.jsx("strong",{children:"Dirección:"})," ",x.direccion]}),e.jsxs("p",{style:{margin:"0.25rem 0"},children:[e.jsx("strong",{children:"Localidad:"})," ",x.localidad]}),e.jsxs("p",{style:{margin:"0.25rem 0"},children:[e.jsx("strong",{children:"Total:"})," $",x.total.toFixed(2)]}),y[x.id]&&y[x.id].length>0&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{style:{margin:"0.5rem 0",border:"none",borderTop:"1px solid #e2e8f0"}}),e.jsx("p",{style:{margin:"0.25rem 0",fontWeight:"bold",color:"#1e293b"},children:"Productos:"}),e.jsx("div",{style:{maxHeight:"150px",overflowY:"auto",marginTop:"0.25rem"},children:y[x.id].map((l,P)=>{const W=l.producto;let ee=(W==null?void 0:W.codigo_producto)||"Producto";return W&&(W.altura_m||W.largo_m||W.separacion_cm)&&(ee+=" - ",W.altura_m&&(ee+=`${W.altura_m}m`),W.largo_m&&(ee+=` x ${W.largo_m}m`),W.separacion_cm&&(ee+=` - ${W.separacion_cm}cm`)),e.jsxs("div",{style:{padding:"0.25rem",marginBottom:"0.25rem",backgroundColor:"#f8fafc",borderRadius:"4px",fontSize:"0.8rem"},children:[e.jsx("div",{style:{fontWeight:"500",color:"#1e293b"},children:ee}),e.jsxs("div",{style:{color:"#64748b"},children:["Cantidad: ",l.cantidad]})]},P)})})]}),e.jsx("hr",{style:{margin:"0.5rem 0",border:"none",borderTop:"1px solid #e2e8f0"}}),e.jsx("p",{style:{margin:"0.5rem 0 0.25rem 0"},children:e.jsx("strong",{children:"Estado:"})}),e.jsx("select",{value:x.estado,onChange:l=>u(x.id,l.target.value),style:{width:"100%",padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1",backgroundColor:O(x.estado).color,color:"white",fontWeight:"bold",cursor:"pointer"},children:Je.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})]})]})})},x.id)})]})}),e.jsxs("div",{className:"table-container",children:[e.jsx("h2",{style:{marginBottom:"1rem",fontSize:"1.25rem"},children:"Ruta Optimizada de Entrega"}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Orden"}),e.jsx("th",{children:"Número Venta"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Dirección"}),e.jsx("th",{children:"Productos"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Estado"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:B.map((x,h)=>{var P;const i=O(x.estado),l=y[x.id]||[];return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{style:{display:"inline-block",width:"32px",height:"32px",lineHeight:"32px",textAlign:"center",borderRadius:"50%",backgroundColor:"#3b82f6",color:"white",fontWeight:"bold",fontSize:"0.9rem"},children:h+1})}),e.jsx("td",{children:x.numero_venta}),e.jsx("td",{children:((P=x.cliente)==null?void 0:P.nombre)||"Sin cliente"}),e.jsxs("td",{children:[e.jsx("div",{children:x.direccion}),e.jsx("div",{style:{fontSize:"0.8rem",color:"#64748b"},children:x.localidad})]}),e.jsx("td",{children:l.length===0?e.jsx("span",{style:{color:"#94a3b8",fontSize:"0.85rem"},children:"Sin productos"}):e.jsx("div",{style:{fontSize:"0.85rem"},children:l.map((W,ee)=>{const H=W.producto;let j=(H==null?void 0:H.codigo_producto)||"Producto";return H&&(H.altura_m||H.largo_m||H.separacion_cm)&&(j+=" - ",H.altura_m&&(j+=`${H.altura_m}m`),H.largo_m&&(j+=` x ${H.largo_m}m`),H.separacion_cm&&(j+=` - ${H.separacion_cm}cm`)),e.jsxs("div",{style:{marginBottom:"0.25rem"},children:[e.jsx("strong",{children:j})," - Cant: ",W.cantidad]},ee)})})}),e.jsxs("td",{children:["$",x.total.toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{style:{padding:"0.25rem 0.75rem",borderRadius:"12px",fontSize:"0.85rem",fontWeight:"500",backgroundColor:i.color,color:"white",display:"inline-block"},children:i.label})}),e.jsx("td",{children:e.jsx("select",{value:x.estado,onChange:W=>u(x.id,W.target.value),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #cbd5e1",cursor:"pointer"},children:Je.map(W=>e.jsx("option",{value:W.value,children:W.label},W.value))})})]},x.id)})})]})]})]})]})})}function Dr(){const[_,E]=o.useState([]),[B,R]=o.useState([]),[N,D]=o.useState([]),[w,G]=o.useState(!0),[X,M]=o.useState(!1),[y,I]=o.useState(""),[A,q]=o.useState(""),[u,k]=o.useState({numero_compra:"",proveedor_id:"",fecha_compra:new Date().toISOString().split("T")[0],descuento:"",cotizacion:"",notas:""}),[f,Q]=o.useState([]),[O,x]=o.useState({producto_id:"",cantidad:"",precio_unitario:""});o.useEffect(()=>{h()},[]);const h=async()=>{try{const[j,v,F]=await Promise.all([c.from("compras").select("*").order("fecha_compra",{ascending:!1}),c.from("proveedores").select("*").eq("activo",!0),c.from("productos").select("*").eq("activo",!0)]);if(j.error)throw j.error;if(v.error)throw v.error;if(F.error)throw F.error;E(j.data||[]),R(v.data||[]),D(F.data||[])}catch(j){I(j.message)}finally{G(!1)}},i=()=>{if(!O.producto_id||!O.cantidad||!O.precio_unitario){I("Complete todos los campos del detalle");return}const j=parseFloat(O.cantidad),v=parseFloat(O.precio_unitario),F=j*v;Q([...f,{producto_id:O.producto_id,cantidad:j,precio_unitario:v,subtotal_item:F}]),x({producto_id:"",cantidad:"",precio_unitario:""})},l=j=>{Q(f.filter((v,F)=>F!==j))},P=()=>{const j=f.reduce((F,a)=>F+a.subtotal_item,0),v=parseFloat(u.descuento)||0;return j-v},W=async j=>{if(j.preventDefault(),I(""),f.length===0){I("Debe agregar al menos un producto a la compra");return}try{const v=f.reduce((oe,le)=>oe+le.subtotal_item,0),F=P(),a={...u,subtotal:v,total:F,descuento:parseFloat(u.descuento)||0,cotizacion:u.cotizacion?parseFloat(u.cotizacion):null},{data:V,error:p}=await c.from("compras").insert([a]).select().single();if(p)throw p;const T=f.map(oe=>({...oe,compra_id:V.id})),{error:z}=await c.from("detalle_compras").insert(T);if(z)throw z;q("Compra registrada exitosamente"),ee(),h(),setTimeout(()=>q(""),3e3)}catch(v){I(v.message)}},ee=()=>{k({numero_compra:"",proveedor_id:"",fecha_compra:new Date().toISOString().split("T")[0],descuento:"",cotizacion:"",notas:""}),Q([]),x({producto_id:"",cantidad:"",precio_unitario:""}),M(!1)},H=j=>{const v=N.find(F=>F.id===j);return v?`${v.codigo_producto} - ${v.nombre}`:j};return w?e.jsx(me,{children:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("div",{className:"loading",children:"Cargando..."})})}):X?e.jsx(me,{children:e.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)",padding:"2rem",color:"white"},children:[e.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"700"},children:"Nueva Compra"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",opacity:.9},children:"Complete los datos para registrar una nueva compra"})]}),e.jsxs("div",{style:{padding:"2rem"},children:[y&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:y})]}),A&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:A})]}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Número Compra *"}),e.jsx("input",{type:"text",value:u.numero_compra,onChange:j=>k({...u,numero_compra:j.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Proveedor"}),e.jsxs("select",{value:u.proveedor_id,onChange:j=>k({...u,proveedor_id:j.target.value}),children:[e.jsx("option",{value:"",children:"Sin proveedor"}),B.map(j=>e.jsx("option",{value:j.id,children:j.nombre},j.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha Compra *"}),e.jsx("input",{type:"date",value:u.fecha_compra,onChange:j=>k({...u,fecha_compra:j.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descuento (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:u.descuento,onChange:j=>k({...u,descuento:j.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cotización Especial (USD)"}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Ej: 45.50",value:u.cotizacion,onChange:j=>k({...u,cotizacion:j.target.value})})]})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsx("label",{children:"Notas"}),e.jsx("textarea",{value:u.notas,onChange:j=>k({...u,notas:j.target.value}),rows:2})]}),e.jsxs("div",{style:{background:"#f8fafc",padding:"2rem",borderRadius:"12px",marginBottom:"2rem"},children:[e.jsx("h3",{style:{margin:"0 0 1.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Productos"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Producto"}),e.jsxs("select",{value:O.producto_id,onChange:j=>{const v=N.find(a=>a.id===j.target.value);let F=(v==null?void 0:v.precio_compra)||0;u.cotizacion&&(v!=null&&v.precio_venta_usd)&&(F=parseFloat(v.precio_venta_usd)*parseFloat(u.cotizacion)),x({...O,producto_id:j.target.value,precio_unitario:F.toString()})},children:[e.jsx("option",{value:"",children:"Seleccionar..."}),N.map(j=>e.jsxs("option",{value:j.id,children:[j.codigo_producto," - ",j.nombre," ($",j.precio_compra,")"]},j.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cantidad"}),e.jsx("input",{type:"number",step:"0.01",value:O.cantidad,onChange:j=>x({...O,cantidad:j.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Precio Unitario"}),e.jsx("input",{type:"number",step:"0.01",value:O.precio_unitario,onChange:j=>x({...O,precio_unitario:j.target.value})})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsxs("button",{type:"button",onClick:i,style:{width:"100%",padding:"0.75rem",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(Ne,{size:20}),"Agregar"]})})]}),f.length>0&&e.jsx("div",{style:{background:"white",borderRadius:"8px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f1f5f9"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Producto"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600"},children:"Cantidad"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Precio Unit."}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Subtotal"}),e.jsx("th",{style:{padding:"0.75rem",width:"50px"}})]})}),e.jsxs("tbody",{children:[f.map((j,v)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:H(j.producto_id)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:j.cantidad}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right"},children:["$",j.precio_unitario.toFixed(2)]}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right"},children:["$",j.subtotal_item.toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:e.jsx("button",{type:"button",onClick:()=>l(v),style:{padding:"0.5rem",backgroundColor:"#fee2e2",color:"#dc2626",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ee,{size:16})})})]},v)),e.jsxs("tr",{style:{background:"#f8fafc",fontWeight:"700",fontSize:"1.1rem"},children:[e.jsx("td",{colSpan:3,style:{padding:"1rem",textAlign:"right"},children:"TOTAL:"}),e.jsxs("td",{colSpan:2,style:{padding:"1rem",textAlign:"right",color:"#2563eb"},children:["$",P().toFixed(2)]})]})]})]})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>M(!1),style:{padding:"0.75rem 1.5rem",backgroundColor:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 2rem",backgroundColor:"#2563eb",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:"Registrar Compra"})]})]})]})]})})}):e.jsx(me,{children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Gestión de Compras"}),e.jsx("p",{children:"Registra compras y actualiza stock automáticamente"})]}),e.jsxs("button",{onClick:()=>M(!0),className:"btn-primary",children:[e.jsx(Ne,{size:20}),"Nueva Compra"]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Número"}),e.jsx("th",{children:"Proveedor"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Total"})]})}),e.jsx("tbody",{children:_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"empty-state",children:"No hay compras registradas"})}):_.map(j=>{var v;return e.jsxs("tr",{children:[e.jsx("td",{children:j.numero_compra}),e.jsx("td",{children:j.proveedor_id||"Sin proveedor"}),e.jsx("td",{children:new Date(j.fecha_compra).toLocaleDateString()}),e.jsxs("td",{children:["$",((v=j.total)==null?void 0:v.toFixed(2))||"0.00"]})]},j.id)})})]})})]})})}const at={Transporte:["Combustible","Reparación","Infracciones","Mantenimiento"],"Mano de obra":[],"Servicios básicos":["UTE","Internet","Publicidad","Web","Mercado Pago","Redes Sociales","CRM"]},Tr=["Efectivo","Transferencia","Tarjeta de Débito","Tarjeta de Crédito","Mercado Pago","Otro"];function Ir(){const[_,E]=o.useState([]),[B,R]=o.useState(!0),[N,D]=o.useState(!1),[w,G]=o.useState(""),[X,M]=o.useState(""),[y,I]=o.useState(null),[A,q]=o.useState(null),[u,k]=o.useState(""),[f,Q]=o.useState(""),[O,x]=o.useState(""),[h,i]=o.useState({fecha:new Date().toISOString().split("T")[0],concepto:"",subcategoria:"",descripcion:"",monto:"",moneda:"UYU",metodo_pago:"",comprobante:""});o.useEffect(()=>{l()},[]);const l=async()=>{var p;try{const[T,z]=await Promise.all([c.from("gastos").select("*").order("fecha",{ascending:!1}),c.from("empresas").select("id").limit(1).maybeSingle()]);if(T.error)throw T.error;if(z.error)throw z.error;E(T.data||[]),I(((p=z.data)==null?void 0:p.id)||null)}catch(T){G(T.message)}finally{R(!1)}},P=p=>{i({...h,concepto:p,subcategoria:""})},W=async p=>{if(p.preventDefault(),G(""),M(""),!y){G("No se pudo obtener la información de la empresa");return}if(!h.concepto||!h.monto){G("El concepto y el monto son requeridos");return}try{const T={empresa_id:y,fecha:h.fecha,concepto:h.concepto,subcategoria:h.subcategoria||null,descripcion:h.descripcion||null,monto:parseFloat(h.monto),moneda:h.moneda,metodo_pago:h.metodo_pago||null,comprobante:h.comprobante||null};if(A){const{error:z}=await c.from("gastos").update({...T,updated_at:new Date().toISOString()}).eq("id",A);if(z)throw z;M("Gasto actualizado exitosamente")}else{const{error:z}=await c.from("gastos").insert([T]);if(z)throw z;M("Gasto registrado exitosamente")}j(),l(),setTimeout(()=>M(""),3e3)}catch(T){G(T.message)}},ee=p=>{i({fecha:p.fecha,concepto:p.concepto,subcategoria:p.subcategoria||"",descripcion:p.descripcion||"",monto:p.monto.toString(),moneda:p.moneda,metodo_pago:p.metodo_pago||"",comprobante:p.comprobante||""}),q(p.id),D(!0)},H=async p=>{if(confirm("¿Está seguro de eliminar este gasto?"))try{const{error:T}=await c.from("gastos").delete().eq("id",p);if(T)throw T;M("Gasto eliminado exitosamente"),l(),setTimeout(()=>M(""),3e3)}catch(T){G(T.message)}},j=()=>{i({fecha:new Date().toISOString().split("T")[0],concepto:"",subcategoria:"",descripcion:"",monto:"",moneda:"UYU",metodo_pago:"",comprobante:""}),q(null),D(!1)},v=_.filter(p=>{var le,te;const T=!u||((le=p.descripcion)==null?void 0:le.toLowerCase().includes(u.toLowerCase()))||((te=p.comprobante)==null?void 0:te.toLowerCase().includes(u.toLowerCase())),z=!f||p.concepto===f,oe=!O||p.subcategoria===O;return T&&z&&oe}),F=v.reduce((p,T)=>p+T.monto,0),a=h.concepto?at[h.concepto]:[],V=f?at[f]:[];return B?e.jsx(me,{children:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("div",{className:"loading",children:"Cargando..."})})}):e.jsx(me,{children:e.jsx("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"2rem"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #dc2626 0%, #b91c1c 100%)",padding:"2rem",color:"white",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"700"},children:"Gastos"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",opacity:.9},children:"Gestiona los gastos de tu empresa"})]}),e.jsxs("button",{onClick:()=>{j(),D(!N)},style:{padding:"0.75rem 1.5rem",backgroundColor:"white",color:"#dc2626",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[N?e.jsx(Te,{size:20}):e.jsx(Ne,{size:20}),N?"Cancelar":"Nuevo Gasto"]})]}),e.jsxs("div",{style:{padding:"2rem"},children:[w&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:w})]}),X&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:X})]}),N&&e.jsxs("div",{style:{background:"#f8fafc",padding:"2rem",borderRadius:"12px",marginBottom:"2rem"},children:[e.jsx("h3",{style:{margin:"0 0 1.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:A?"Editar Gasto":"Nuevo Gasto"}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha *"}),e.jsx("input",{type:"date",value:h.fecha,onChange:p=>i({...h,fecha:p.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Concepto *"}),e.jsxs("select",{value:h.concepto,onChange:p=>P(p.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar concepto..."}),Object.keys(at).map(p=>e.jsx("option",{value:p,children:p},p))]})]}),a.length>0&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Subcategoría"}),e.jsxs("select",{value:h.subcategoria,onChange:p=>i({...h,subcategoria:p.target.value}),children:[e.jsx("option",{value:"",children:"Seleccionar subcategoría..."}),a.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Monto *"}),e.jsx("input",{type:"number",step:"0.01",value:h.monto,onChange:p=>i({...h,monto:p.target.value}),placeholder:"0.00",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Método de Pago"}),e.jsxs("select",{value:h.metodo_pago,onChange:p=>i({...h,metodo_pago:p.target.value}),children:[e.jsx("option",{value:"",children:"Seleccionar método..."}),Tr.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Comprobante"}),e.jsx("input",{type:"text",value:h.comprobante,onChange:p=>i({...h,comprobante:p.target.value}),placeholder:"Número de comprobante"})]})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"1.5rem"},children:[e.jsx("label",{children:"Descripción"}),e.jsx("textarea",{value:h.descripcion,onChange:p=>i({...h,descripcion:p.target.value}),placeholder:"Descripción adicional del gasto",rows:3})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:j,style:{padding:"0.75rem 1.5rem",backgroundColor:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"}),e.jsxs("button",{type:"submit",style:{padding:"0.75rem 2rem",backgroundColor:"#dc2626",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600"},children:[A?"Actualizar":"Guardar"," Gasto"]})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"1.5rem",flexWrap:"wrap"},children:[e.jsx("input",{type:"text",placeholder:"Buscar por descripción o comprobante...",value:u,onChange:p=>k(p.target.value),style:{flex:"1",minWidth:"250px",padding:"0.75rem",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"0.95rem"}}),e.jsxs("select",{value:f,onChange:p=>{Q(p.target.value),x("")},style:{padding:"0.75rem",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"0.95rem",minWidth:"200px"},children:[e.jsx("option",{value:"",children:"Todos los conceptos"}),Object.keys(at).map(p=>e.jsx("option",{value:p,children:p},p))]}),V.length>0&&e.jsxs("select",{value:O,onChange:p=>x(p.target.value),style:{padding:"0.75rem",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"0.95rem",minWidth:"200px"},children:[e.jsx("option",{value:"",children:"Todas las subcategorías"}),V.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{style:{background:"#f8fafc",padding:"1rem 1.5rem",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"600",color:"#374151"},children:"Total de Gastos:"}),e.jsxs("span",{style:{fontSize:"1.5rem",fontWeight:"700",color:"#dc2626"},children:["$",F.toFixed(2)]})]}),v.length===0?e.jsx("div",{style:{textAlign:"center",padding:"3rem",color:"#9ca3af"},children:e.jsx("p",{style:{fontSize:"1.1rem"},children:"No hay gastos registrados"})}):e.jsx("div",{style:{background:"white",borderRadius:"8px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f1f5f9"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Fecha"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Concepto"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Subcategoría"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Descripción"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Método Pago"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Monto"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600"},children:"Acciones"})]})}),e.jsx("tbody",{children:v.map(p=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:new Date(p.fecha).toLocaleDateString("es-UY")}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{style:{padding:"4px 12px",borderRadius:"12px",fontSize:"0.85rem",fontWeight:"500",backgroundColor:p.concepto==="Transporte"?"#dbeafe":p.concepto==="Mano de obra"?"#fef3c7":"#dcfce7",color:p.concepto==="Transporte"?"#1e40af":p.concepto==="Mano de obra"?"#ca8a04":"#16a34a"},children:p.concepto})}),e.jsx("td",{style:{padding:"0.75rem"},children:p.subcategoria||"-"}),e.jsx("td",{style:{padding:"0.75rem",maxWidth:"200px"},children:p.descripcion?e.jsx("span",{style:{fontSize:"0.9rem",color:"#6b7280"},children:p.descripcion}):"-"}),e.jsx("td",{style:{padding:"0.75rem"},children:p.metodo_pago||"-"}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600",color:"#dc2626"},children:["$",p.monto.toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>ee(p),style:{padding:"0.5rem",backgroundColor:"#dbeafe",color:"#2563eb",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Editar",children:e.jsx(ht,{size:16})}),e.jsx("button",{onClick:()=>H(p.id),style:{padding:"0.5rem",backgroundColor:"#fee2e2",color:"#dc2626",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Eliminar",children:e.jsx(Ee,{size:16})})]})})]},p.id))})]})})]})]})})})}function Mr(){const[_,E]=o.useState({ventasHoy:0,ventasMes:0,totalVentas:0,gananciaTotal:0,productosVendidos:0,comprasMes:0}),[B,R]=o.useState([]),[N,D]=o.useState(!0),[w,G]=o.useState(null);o.useEffect(()=>{(async()=>{const{data:{user:y}}=await c.auth.getUser();if(y){const{data:I}=await c.from("usuarios").select("empresa_id").eq("auth_id",y.id).single();I&&G(I.empresa_id)}})()},[]),o.useEffect(()=>{w&&X()},[w]);const X=async()=>{var M,y,I,A;if(w)try{const q=new Date,u=new Date(q.setHours(0,0,0,0)).toISOString(),k=new Date(q.getFullYear(),q.getMonth(),1).toISOString(),[f,Q,O,x,h]=await Promise.all([c.from("ventas").select("total").eq("empresa_id",w).gte("fecha_venta",u),c.from("ventas").select("total").eq("empresa_id",w).gte("fecha_venta",k),c.from("ventas").select("total").eq("empresa_id",w),c.from("compras").select("total").eq("empresa_id",w).gte("fecha_compra",k),c.from("ventas").select("numero_venta, fecha_venta, total, cliente_id").eq("empresa_id",w).order("fecha_venta",{ascending:!1}).limit(10)]),i=((M=f.data)==null?void 0:M.reduce((F,a)=>F+(a.total||0),0))||0,l=((y=Q.data)==null?void 0:y.reduce((F,a)=>F+(a.total||0),0))||0,P=((I=O.data)==null?void 0:I.reduce((F,a)=>F+(a.total||0),0))||0,W=((A=x.data)==null?void 0:A.reduce((F,a)=>F+(a.total||0),0))||0,{data:ee}=await c.from("detalles_venta").select(`
          cantidad,
          precio_unitario,
          producto:productos(
            precio_costo_m2,
            precio_compra_uyu,
            m2_rollo
          )
        `).eq("empresa_id",w),{data:H}=await c.from("cotizacion_dolar").select("valor").eq("empresa_id",w).maybeSingle(),j=(H==null?void 0:H.valor)||0;let v=0;ee&&ee.forEach(F=>{const a=F.producto;if(a){const V=parseFloat(F.precio_unitario)||0,p=parseFloat(F.cantidad)||0;let T=0;a.precio_costo_m2&&j>0?T=parseFloat(a.precio_costo_m2)*j:a.precio_compra_uyu&&a.m2_rollo&&(T=parseFloat(a.precio_compra_uyu)/parseFloat(a.m2_rollo)),v+=(V-T)*p}}),E({ventasHoy:i,ventasMes:l,totalVentas:P,gananciaTotal:v,productosVendidos:0,comprasMes:W}),R(h.data||[])}catch(q){console.error("Error loading reports:",q)}finally{D(!1)}};return e.jsx(me,{children:e.jsxs("div",{className:"page-container",children:[e.jsx("div",{className:"page-header",children:e.jsxs("div",{children:[e.jsx("h1",{children:"Reportes y Métricas"}),e.jsx("p",{children:"Analiza el rendimiento de tu negocio"})]})}),N?e.jsx("div",{className:"loading",children:"Cargando reportes..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"metrics-grid",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#d1fae5"},children:e.jsx(et,{size:24,color:"#10b981"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Ventas Hoy"}),e.jsxs("p",{className:"metric-value",children:["$",_.ventasHoy.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#dbeafe"},children:e.jsx(Qe,{size:24,color:"#0284c7"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Ventas del Mes"}),e.jsxs("p",{className:"metric-value",children:["$",_.ventasMes.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#e0e7ff"},children:e.jsx(tt,{size:24,color:"#2563eb"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Total Ventas"}),e.jsxs("p",{className:"metric-value",children:["$",_.totalVentas.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#fef3c7"},children:e.jsx($e,{size:24,color:"#f59e0b"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Ganancia Total"}),e.jsxs("p",{className:"metric-value",children:["$",_.gananciaTotal.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#fee2e2"},children:e.jsx(tt,{size:24,color:"#ef4444"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Compras del Mes"}),e.jsxs("p",{className:"metric-value",children:["$",_.comprasMes.toFixed(2)]})]})]}),e.jsxs("div",{className:"metric-card",children:[e.jsx("div",{className:"metric-icon",style:{backgroundColor:"#d1fae5"},children:e.jsx(Qe,{size:24,color:"#10b981"})}),e.jsxs("div",{className:"metric-content",children:[e.jsx("p",{className:"metric-label",children:"Ganancia del Mes"}),e.jsxs("p",{className:"metric-value",children:["$",(_.ventasMes-_.comprasMes).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"table-container",children:[e.jsx("h2",{style:{padding:"1.5rem",margin:0,borderBottom:"1px solid var(--neutral-200)"},children:"Ventas Recientes"}),e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Número"}),e.jsx("th",{children:"Fecha"}),e.jsx("th",{children:"Cliente"}),e.jsx("th",{children:"Total"})]})}),e.jsx("tbody",{children:B.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"empty-state",children:"No hay ventas recientes"})}):B.map(M=>{var y;return e.jsxs("tr",{children:[e.jsx("td",{children:M.numero_venta}),e.jsx("td",{children:new Date(M.fecha_venta).toLocaleDateString()}),e.jsx("td",{children:M.cliente_id||"Sin cliente"}),e.jsxs("td",{children:["$",((y=M.total)==null?void 0:y.toFixed(2))||"0.00"]})]},M.numero_venta)})})]})]})]})]})})}function $r(){const[_,E]=o.useState([]),[B,R]=o.useState(!0),[N,D]=o.useState(!1),[w,G]=o.useState(null),[X,M]=o.useState(""),[y,I]=o.useState(""),[A,q]=o.useState(null),[u,k]=o.useState({nombre:"",email:"",telefono:"",direccion:"",ciudad:""});o.useEffect(()=>{f()},[]);const f=async()=>{var i;try{const[l,P]=await Promise.all([c.from("clientes").select("*").eq("activo",!0),c.from("empresas").select("id").limit(1).maybeSingle()]);if(l.error)throw l.error;if(P.error)throw P.error;E(l.data||[]),q(((i=P.data)==null?void 0:i.id)||null)}catch(l){M(l.message)}finally{R(!1)}},Q=async i=>{if(i.preventDefault(),M(""),I(""),!A&&!w){M("No se pudo obtener la información de la empresa");return}try{if(w){const{error:l}=await c.from("clientes").update(u).eq("id",w);if(l)throw l;I("Cliente actualizado exitosamente")}else{const{error:l}=await c.from("clientes").insert([{...u,empresa_id:A}]);if(l)throw l;I("Cliente creado exitosamente")}setTimeout(()=>I(""),3e3),x(),f()}catch(l){M(l.message)}},O=async i=>{if(confirm("¿Está seguro de que desea eliminar este cliente?"))try{const{error:l}=await c.from("clientes").update({activo:!1}).eq("id",i);if(l)throw l;I("Cliente eliminado exitosamente"),setTimeout(()=>I(""),3e3),f()}catch(l){M(l.message)}},x=()=>{k({nombre:"",email:"",telefono:"",direccion:"",ciudad:""}),G(null),D(!1)},h=i=>{k({nombre:i.nombre,email:i.email||"",telefono:i.telefono||"",direccion:i.direccion||"",ciudad:i.ciudad||""}),G(i.id),D(!0)};return B?e.jsx(me,{children:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("div",{className:"loading",children:"Cargando..."})})}):N?e.jsx(me,{children:e.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",padding:"2rem",color:"white"},children:[e.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"700"},children:w?"Editar Cliente":"Nuevo Cliente"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",opacity:.9},children:w?"Actualiza los datos del cliente":"Complete los datos para registrar un nuevo cliente"})]}),e.jsxs("div",{style:{padding:"2rem"},children:[X&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:X})]}),y&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:y})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{type:"text",value:u.nombre,onChange:i=>k({...u,nombre:i.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:u.email,onChange:i=>k({...u,email:i.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Teléfono"}),e.jsx("input",{type:"text",value:u.telefono,onChange:i=>k({...u,telefono:i.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Ciudad"}),e.jsx("input",{type:"text",value:u.ciudad,onChange:i=>k({...u,ciudad:i.target.value})})]})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsx("label",{children:"Dirección"}),e.jsx("input",{type:"text",value:u.direccion,onChange:i=>k({...u,direccion:i.target.value})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:x,style:{padding:"0.75rem 1.5rem",backgroundColor:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 2rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:w?"Guardar Cambios":"Crear Cliente"})]})]})]})]})})}):e.jsx(me,{children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Gestión de Clientes"}),e.jsx("p",{children:"Administra tu base de clientes"})]}),e.jsxs("button",{onClick:()=>D(!0),className:"btn-primary",children:[e.jsx(Ne,{size:20}),"Nuevo Cliente"]})]}),X&&e.jsxs("div",{className:"error-alert",children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:X})]}),y&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:y})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Teléfono"}),e.jsx("th",{children:"Ciudad"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"empty-state",children:"No hay clientes registrados"})}):_.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.nombre}),e.jsx("td",{children:i.email||"-"}),e.jsx("td",{children:i.telefono||"-"}),e.jsx("td",{children:i.ciudad||"-"}),e.jsxs("td",{className:"action-cell",children:[e.jsx("button",{onClick:()=>h(i),className:"btn-icon edit",title:"Editar",children:e.jsx(xt,{size:18})}),e.jsx("button",{onClick:()=>O(i.id),className:"btn-icon delete",title:"Eliminar",children:e.jsx(Ee,{size:18})})]})]},i.id))})]})})]})})}function Wr(){const[_,E]=o.useState([]),[B,R]=o.useState(!0),[N,D]=o.useState(!1),[w,G]=o.useState(null),[X,M]=o.useState(""),[y,I]=o.useState(""),[A,q]=o.useState(null),[u,k]=o.useState({nombre:"",contacto_principal:"",email:"",telefono:"",direccion:""});o.useEffect(()=>{f()},[]);const f=async()=>{var i;try{const[l,P]=await Promise.all([c.from("proveedores").select("*").eq("activo",!0),c.from("empresas").select("id").limit(1).maybeSingle()]);if(l.error)throw l.error;if(P.error)throw P.error;E(l.data||[]),q(((i=P.data)==null?void 0:i.id)||null)}catch(l){M(l.message)}finally{R(!1)}},Q=async i=>{if(i.preventDefault(),M(""),I(""),!A&&!w){M("No se pudo obtener la información de la empresa");return}try{if(w){const{error:l}=await c.from("proveedores").update(u).eq("id",w);if(l)throw l;I("Proveedor actualizado exitosamente")}else{const{error:l}=await c.from("proveedores").insert([{...u,empresa_id:A}]);if(l)throw l;I("Proveedor creado exitosamente")}setTimeout(()=>I(""),3e3),x(),f()}catch(l){M(l.message)}},O=async i=>{if(confirm("¿Está seguro de que desea eliminar este proveedor?"))try{const{error:l}=await c.from("proveedores").update({activo:!1}).eq("id",i);if(l)throw l;I("Proveedor eliminado exitosamente"),setTimeout(()=>I(""),3e3),f()}catch(l){M(l.message)}},x=()=>{k({nombre:"",contacto_principal:"",email:"",telefono:"",direccion:""}),G(null),D(!1)},h=i=>{k({nombre:i.nombre,contacto_principal:i.contacto_principal||"",email:i.email||"",telefono:i.telefono||"",direccion:i.direccion||""}),G(i.id),D(!0)};return B?e.jsx(me,{children:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("div",{className:"loading",children:"Cargando..."})})}):N?e.jsx(me,{children:e.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #f97316 0%, #ea580c 100%)",padding:"2rem",color:"white"},children:[e.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"700"},children:w?"Editar Proveedor":"Nuevo Proveedor"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",opacity:.9},children:w?"Actualiza los datos del proveedor":"Complete los datos para registrar un nuevo proveedor"})]}),e.jsxs("div",{style:{padding:"2rem"},children:[X&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:X})]}),y&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:y})]}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{type:"text",value:u.nombre,onChange:i=>k({...u,nombre:i.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Contacto"}),e.jsx("input",{type:"text",value:u.contacto_principal,onChange:i=>k({...u,contacto_principal:i.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:u.email,onChange:i=>k({...u,email:i.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Teléfono"}),e.jsx("input",{type:"text",value:u.telefono,onChange:i=>k({...u,telefono:i.target.value})})]})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsx("label",{children:"Dirección"}),e.jsx("input",{type:"text",value:u.direccion,onChange:i=>k({...u,direccion:i.target.value})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:x,style:{padding:"0.75rem 1.5rem",backgroundColor:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:"Cancelar"}),e.jsx("button",{type:"submit",style:{padding:"0.75rem 2rem",backgroundColor:"#f97316",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:w?"Guardar Cambios":"Crear Proveedor"})]})]})]})]})})}):e.jsx(me,{children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Gestión de Proveedores"}),e.jsx("p",{children:"Administra tus proveedores"})]}),e.jsxs("button",{onClick:()=>D(!0),className:"btn-primary",children:[e.jsx(Ne,{size:20}),"Nuevo Proveedor"]})]}),X&&e.jsxs("div",{className:"error-alert",children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:X})]}),y&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:y})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Contacto"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Teléfono"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"empty-state",children:"No hay proveedores registrados"})}):_.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.nombre}),e.jsx("td",{children:i.contacto_principal||"-"}),e.jsx("td",{children:i.email||"-"}),e.jsx("td",{children:i.telefono||"-"}),e.jsxs("td",{className:"action-cell",children:[e.jsx("button",{onClick:()=>h(i),className:"btn-icon edit",title:"Editar",children:e.jsx(xt,{size:18})}),e.jsx("button",{onClick:()=>O(i.id),className:"btn-icon delete",title:"Eliminar",children:e.jsx(Ee,{size:18})})]})]},i.id))})]})})]})})}function Br(){const[_,E]=o.useState([]),[B,R]=o.useState([]),[N,D]=o.useState([]),[w,G]=o.useState(!0),[X,M]=o.useState(!1),[y,I]=o.useState(null),[A,q]=o.useState(""),[u,k]=o.useState(""),[f,Q]=o.useState(null),[O,x]=o.useState(null),[h,i]=o.useState({}),[l,P]=o.useState({nombre:"",descripcion:"",precio_total:""}),[W,ee]=o.useState([]),[H,j]=o.useState({categoria_id:"",producto_id:"",cantidad:""}),[v,F]=o.useState([]);o.useEffect(()=>{a()},[]);const a=async()=>{var d;try{const[C,L,Z,ae]=await Promise.all([c.from("promociones").select("*").eq("activo",!0).order("nombre"),c.from("productos").select("*").eq("activo",!0),c.from("categorias").select("*").order("nombre"),c.from("empresas").select("id").limit(1).maybeSingle()]);if(C.error)throw C.error;if(L.error)throw L.error;if(Z.error)throw Z.error;if(ae.error)throw ae.error;E(C.data||[]),R(L.data||[]),D(Z.data||[]),Q(((d=ae.data)==null?void 0:d.id)||null)}catch(C){q(C.message)}finally{G(!1)}},V=async d=>{if(!h[d])try{const{data:C,error:L}=await c.from("detalle_promociones").select("*, producto:productos(codigo_producto, nombre, altura_m, largo_m, separacion_cm, precio_venta)").eq("promocion_id",d);if(L)throw L;i(Z=>({...Z,[d]:C||[]}))}catch(C){q(C.message)}},p=async d=>{O===d?x(null):(x(d),await V(d))},T=d=>{if(j({...H,categoria_id:d,producto_id:""}),d){const C=B.filter(L=>L.categoria_id===d);F(C)}else F([])},z=()=>{if(!H.producto_id||!H.cantidad){q("Complete todos los campos del producto"),setTimeout(()=>q(""),3e3);return}if(W.find(C=>C.producto_id===H.producto_id)){q("Este producto ya fue agregado a la promoción"),setTimeout(()=>q(""),3e3);return}ee([...W,{producto_id:H.producto_id,cantidad:parseFloat(H.cantidad)}]),j({categoria_id:"",producto_id:"",cantidad:""}),F([])},oe=d=>{ee(W.filter((C,L)=>L!==d))},le=()=>W.reduce((d,C)=>{const L=B.find(Z=>Z.id===C.producto_id);return L&&L.precio_venta?d+L.precio_venta*C.cantidad:d},0),te=async d=>{if(d.preventDefault(),q(""),k(""),W.length===0){q("Debe agregar al menos un producto a la promoción");return}if(!f&&!y){q("No se pudo obtener la información de la empresa");return}try{if(y){const{error:C}=await c.from("promociones").update({nombre:l.nombre,descripcion:l.descripcion,precio_total:parseFloat(l.precio_total)}).eq("id",y);if(C)throw C;const{error:L}=await c.from("detalle_promociones").delete().eq("promocion_id",y);if(L)throw L;const Z=W.map(se=>({...se,promocion_id:y})),{error:ae}=await c.from("detalle_promociones").insert(Z);if(ae)throw ae;k("Promoción actualizada exitosamente"),i({})}else{const{data:C,error:L}=await c.from("promociones").insert([{...l,empresa_id:f,precio_total:parseFloat(l.precio_total)}]).select().single();if(L)throw L;const Z=W.map(se=>({...se,promocion_id:C.id})),{error:ae}=await c.from("detalle_promociones").insert(Z);if(ae)throw ae;k("Promoción creada exitosamente")}setTimeout(()=>k(""),3e3),s(),a()}catch(C){q(C.message)}},ce=async d=>{P({nombre:d.nombre,descripcion:d.descripcion||"",precio_total:d.precio_total.toString()}),I(d.id);try{const{data:C,error:L}=await c.from("detalle_promociones").select("producto_id, cantidad").eq("promocion_id",d.id);if(L)throw L;ee(C||[])}catch(C){q(C.message)}M(!0)},J=async d=>{if(confirm("¿Está seguro de que desea eliminar esta promoción?"))try{const{error:C}=await c.from("promociones").update({activo:!1}).eq("id",d);if(C)throw C;k("Promoción eliminada exitosamente"),setTimeout(()=>k(""),3e3),a()}catch(C){q(C.message)}},s=()=>{P({nombre:"",descripcion:"",precio_total:""}),ee([]),j({categoria_id:"",producto_id:"",cantidad:""}),F([]),I(null),M(!1)},Y=d=>{const C=B.find(Z=>Z.id===d);if(!C)return d;let L=`${C.codigo_producto} - ${C.nombre}`;return(C.altura_m||C.largo_m||C.separacion_cm)&&(L+=" (",C.altura_m&&(L+=`${C.altura_m}m`),C.largo_m&&(L+=` x ${C.largo_m}m`),C.separacion_cm&&(L+=` - ${C.separacion_cm}cm`),L+=")"),L};return w?e.jsx(me,{children:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("div",{className:"loading",children:"Cargando..."})})}):e.jsx(me,{children:e.jsxs("div",{className:"page-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Gestión de Promociones"}),e.jsx("p",{children:"Crea combos y paquetes con descuentos especiales"})]}),e.jsxs("button",{onClick:()=>M(!X),className:"btn-primary",children:[e.jsx(Ne,{size:20}),"Nueva Promoción"]})]}),A&&e.jsxs("div",{className:"error-alert",children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:A}),e.jsx("button",{onClick:()=>q(""),style:{marginLeft:"auto",background:"none",border:"none"},children:e.jsx(Te,{size:20})})]}),u&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:u})]}),X&&e.jsxs("div",{className:"form-card",children:[e.jsx("h2",{children:y?"Editar Promoción":"Nueva Promoción"}),e.jsxs("form",{onSubmit:te,children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre de la Promoción *"}),e.jsx("input",{type:"text",value:l.nombre,onChange:d=>P({...l,nombre:d.target.value}),placeholder:"Ej: Combo Cerco Completo",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Precio Total (UYU) *"}),e.jsx("input",{type:"number",step:"0.01",value:l.precio_total,onChange:d=>P({...l,precio_total:d.target.value}),placeholder:"0.00",required:!0}),W.length>0&&e.jsxs("small",{style:{color:"#6b7280",fontSize:"0.85rem"},children:["Precio sugerido (suma individual): $",le().toFixed(2)]})]})]}),e.jsxs("div",{className:"form-group",style:{marginTop:"1rem"},children:[e.jsx("label",{children:"Descripción"}),e.jsx("textarea",{value:l.descripcion,onChange:d=>P({...l,descripcion:d.target.value}),rows:3,placeholder:"Describe los beneficios de esta promoción..."})]}),e.jsxs("div",{style:{marginTop:"2rem",borderTop:"2px solid #e5e7eb",paddingTop:"2rem"},children:[e.jsxs("h3",{style:{marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx($e,{size:20}),"Productos del Combo"]}),e.jsxs("div",{className:"form-grid",style:{marginBottom:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Categoría"}),e.jsxs("select",{value:H.categoria_id,onChange:d=>T(d.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar categoría..."}),N.map(d=>e.jsx("option",{value:d.id,children:d.nombre},d.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Producto"}),e.jsxs("select",{value:H.producto_id,onChange:d=>j({...H,producto_id:d.target.value}),disabled:!H.categoria_id,children:[e.jsx("option",{value:"",children:"Seleccionar producto..."}),v.map(d=>{let C="";d.altura_m&&(C+=`${d.altura_m}m`),d.largo_m&&(C+=` x ${d.largo_m}m`),d.separacion_cm&&(C+=` - ${d.separacion_cm}cm`);const L=d.precio_venta?` - $${Number(d.precio_venta).toFixed(2)}`:"";return e.jsxs("option",{value:d.id,children:[d.nombre," ",C&&`(${C})`,L]},d.id)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cantidad"}),e.jsx("input",{type:"number",step:"0.01",value:H.cantidad,onChange:d=>j({...H,cantidad:d.target.value}),placeholder:"0"})]})]}),e.jsxs("button",{type:"button",onClick:z,className:"btn-secondary",children:[e.jsx(Ne,{size:18}),"Agregar Producto"]}),W.length>0&&e.jsx("div",{className:"table-container",style:{marginTop:"1.5rem"},children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Producto"}),e.jsx("th",{children:"Cantidad"}),e.jsx("th",{children:"Precio Unit."}),e.jsx("th",{children:"Subtotal"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:W.map((d,C)=>{const L=B.find(se=>se.id===d.producto_id),Z=(L==null?void 0:L.precio_venta)||0,ae=Z*d.cantidad;return e.jsxs("tr",{children:[e.jsx("td",{children:Y(d.producto_id)}),e.jsx("td",{children:d.cantidad}),e.jsxs("td",{children:["$",Z.toFixed(2)]}),e.jsxs("td",{children:["$",ae.toFixed(2)]}),e.jsx("td",{children:e.jsx("button",{type:"button",onClick:()=>oe(C),className:"btn-icon delete",children:e.jsx(Ee,{size:16})})})]},C)})})]})})]}),e.jsxs("div",{className:"form-actions",style:{marginTop:"2rem"},children:[e.jsx("button",{type:"submit",className:"btn-primary",children:y?"Guardar Cambios":"Crear Promoción"}),e.jsx("button",{type:"button",onClick:s,className:"btn-secondary",children:"Cancelar"})]})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Nombre"}),e.jsx("th",{children:"Descripción"}),e.jsx("th",{children:"Precio"}),e.jsx("th",{children:"Productos"}),e.jsx("th",{children:"Acciones"})]})}),e.jsx("tbody",{children:_.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"empty-state",children:"No hay promociones registradas"})}):_.map(d=>e.jsxs(o.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{fontWeight:"600"},children:d.nombre}),e.jsx("td",{children:d.descripcion||"-"}),e.jsxs("td",{style:{fontWeight:"600",color:"#059669"},children:["$",d.precio_total.toFixed(2)]}),e.jsx("td",{children:e.jsx("button",{onClick:()=>p(d.id),style:{padding:"4px 12px",fontSize:"13px",background:"#f3f4f6",border:"1px solid #d1d5db",borderRadius:"6px",cursor:"pointer",fontWeight:"500"},children:O===d.id?"Ocultar":"Ver productos"})}),e.jsxs("td",{className:"action-cell",children:[e.jsx("button",{onClick:()=>ce(d),className:"btn-icon edit",title:"Editar",children:e.jsx(xt,{size:18})}),e.jsx("button",{onClick:()=>J(d.id),className:"btn-icon delete",title:"Eliminar",children:e.jsx(Ee,{size:18})})]})]}),O===d.id&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{padding:"1rem 2rem",backgroundColor:"#f8fafc"},children:h[d.id]?h[d.id].length===0?e.jsx("div",{style:{textAlign:"center",color:"#6b7280"},children:"No hay productos en esta promoción"}):e.jsxs("div",{children:[e.jsx("h4",{style:{marginBottom:"0.75rem",color:"#1e293b"},children:"Productos incluidos en el combo:"}),e.jsxs("table",{style:{width:"100%",backgroundColor:"white",borderRadius:"8px"},children:[e.jsx("thead",{style:{backgroundColor:"#e2e8f0"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{padding:"0.5rem",textAlign:"left",border:"1px solid #cbd5e1"},children:"Producto"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"center",border:"1px solid #cbd5e1"},children:"Cantidad"}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",border:"1px solid #cbd5e1"},children:"Precio Unit."}),e.jsx("th",{style:{padding:"0.5rem",textAlign:"right",border:"1px solid #cbd5e1"},children:"Subtotal"})]})}),e.jsxs("tbody",{children:[h[d.id].map((C,L)=>{const Z=C.producto;let ae=Z?`${Z.codigo_producto} - ${Z.nombre}`:"Producto no encontrado";Z&&(Z.altura_m||Z.largo_m||Z.separacion_cm)&&(ae+=" (",Z.altura_m&&(ae+=`${Z.altura_m}m`),Z.largo_m&&(ae+=` x ${Z.largo_m}m`),Z.separacion_cm&&(ae+=` - ${Z.separacion_cm}cm`),ae+=")");const se=(Z==null?void 0:Z.precio_venta)||0,be=se*C.cantidad;return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"0.5rem",border:"1px solid #cbd5e1"},children:ae}),e.jsx("td",{style:{padding:"0.5rem",textAlign:"center",border:"1px solid #cbd5e1"},children:C.cantidad}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",border:"1px solid #cbd5e1"},children:["$",se.toFixed(2)]}),e.jsxs("td",{style:{padding:"0.5rem",textAlign:"right",border:"1px solid #cbd5e1"},children:["$",be.toFixed(2)]})]},L)}),e.jsxs("tr",{style:{fontWeight:"bold",backgroundColor:"#f1f5f9"},children:[e.jsx("td",{colSpan:3,style:{padding:"0.75rem",textAlign:"right",border:"1px solid #cbd5e1"},children:"Precio del combo:"}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",border:"1px solid #cbd5e1",color:"#059669"},children:["$",d.precio_total.toFixed(2)]})]}),e.jsxs("tr",{style:{backgroundColor:"#fef3c7"},children:[e.jsx("td",{colSpan:3,style:{padding:"0.75rem",textAlign:"right",border:"1px solid #cbd5e1",fontWeight:"600"},children:"Ahorro:"}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right",border:"1px solid #cbd5e1",color:"#d97706",fontWeight:"700"},children:["$",(h[d.id].reduce((C,L)=>{var Z;return C+(((Z=L.producto)==null?void 0:Z.precio_venta)||0)*L.cantidad},0)-d.precio_total).toFixed(2)]})]})]})]})]}):e.jsx("div",{style:{textAlign:"center",color:"#6b7280"},children:"Cargando..."})})})]},d.id))})]})})]})})}function Lr(){const _=rt(),[E,B]=o.useState([]),[R,N]=o.useState([]),[D,w]=o.useState(!0),[G,X]=o.useState(""),[M,y]=o.useState("todos"),[I,A]=o.useState(!1),[q,u]=o.useState(null),[k,f]=o.useState(!1),[Q,O]=o.useState(""),[x,h]=o.useState(""),[i,l]=o.useState({metodo_pago:"efectivo",localidad:"",direccion_entrega:"",latitud:null,longitud:null,costo_delivery:"",notas_venta:""});o.useEffect(()=>{P()},[]),o.useEffect(()=>{W()},[G,M,E]);const P=async()=>{try{const{data:a,error:V}=await c.from("presupuestos").select(`
          id,
          numero_presupuesto,
          fecha_presupuesto,
          total,
          estado,
          notas,
          cliente_id,
          descuento,
          subtotal,
          clientes(nombre)
        `).order("fecha_presupuesto",{ascending:!1});if(V)throw V;const p=(a||[]).map(T=>({id:T.id,numero_presupuesto:T.numero_presupuesto,fecha_presupuesto:T.fecha_presupuesto,total:T.total,estado:T.estado,notas:T.notas,cliente_id:T.cliente_id,descuento:T.descuento,subtotal:T.subtotal,cliente:T.clientes?{nombre:T.clientes.nombre}:null}));B(p)}catch(a){console.error("Error al cargar presupuestos:",a.message)}finally{w(!1)}},W=()=>{let a=E;M!=="todos"&&(a=a.filter(V=>V.estado===M)),G&&(a=a.filter(V=>{var p;return V.numero_presupuesto.toLowerCase().includes(G.toLowerCase())||((p=V.cliente)==null?void 0:p.nombre.toLowerCase().includes(G.toLowerCase()))})),N(a)},ee=async(a,V)=>{if(V==="aprobado"||V==="convertido")u(a),A(!0);else try{const{error:p}=await c.from("presupuestos").update({estado:V,updated_at:new Date().toISOString()}).eq("id",a.id);if(p)throw p;P()}catch(p){console.error("Error al cambiar estado:",p.message),O(p.message)}},H=async()=>{if(q){f(!0),O("");try{const{data:a,error:V}=await c.from("detalle_presupuestos").select("producto_id, cantidad, precio_unitario, subtotal_item").eq("presupuesto_id",q.id);if(V)throw V;if(!a||a.length===0)throw new Error("El presupuesto no tiene productos");const{data:p,error:T}=await c.from("empresas").select("id").limit(1).maybeSingle();if(T)throw T;if(!p)throw new Error("No se encontró la empresa");const z=new Date().toISOString().split("T")[0],{data:oe,error:le}=await c.from("ventas").select("numero_venta").like("numero_venta",`V-${z}%`).order("numero_venta",{ascending:!1}).limit(1);if(le)throw le;let te=1;if(oe&&oe.length>0){const se=oe[0].numero_venta.split("-");se.length===5&&(te=parseInt(se[4])+1)}const ce=`V-${z}-${te.toString().padStart(3,"0")}`,J=parseFloat(i.costo_delivery)||0,s=q.total+J,Y={numero_venta:ce,empresa_id:p.id,cliente_id:q.cliente_id,fecha_venta:new Date().toISOString().split("T")[0],subtotal:q.subtotal,descuento:q.descuento,total:s,metodo_pago:i.metodo_pago,localidad:i.localidad||null,direccion_entrega:i.direccion_entrega||null,latitud:i.latitud,longitud:i.longitud,costo_delivery:J,notas:i.notas_venta||q.notas||null},{data:d,error:C}=await c.from("ventas").insert([Y]).select().single();if(C)throw C;const L=a.map(se=>({venta_id:d.id,producto_id:se.producto_id,cantidad:se.cantidad,precio_unitario:se.precio_unitario,subtotal_item:se.subtotal_item})),{error:Z}=await c.from("detalle_ventas").insert(L);if(Z)throw Z;for(const se of a){const{data:be,error:ze}=await c.from("productos").select("stock").eq("id",se.producto_id).single();if(ze)throw ze;const re=be.stock-se.cantidad,{error:n}=await c.from("productos").update({stock:re}).eq("id",se.producto_id);if(n)throw n;const{error:m}=await c.from("historial_stock").insert({empresa_id:p.id,producto_id:se.producto_id,tipo_movimiento:"salida",cantidad:se.cantidad,stock_anterior:be.stock,stock_nuevo:re,motivo:`Venta ${ce} (Presupuesto ${q.numero_presupuesto})`});if(m)throw m}const{error:ae}=await c.from("presupuestos").update({estado:"convertido",updated_at:new Date().toISOString()}).eq("id",q.id);if(ae)throw ae;h(`Presupuesto convertido exitosamente a venta ${ce}`),A(!1),u(null),l({metodo_pago:"efectivo",localidad:"",direccion_entrega:"",latitud:null,longitud:null,costo_delivery:"",notas_venta:""}),P(),setTimeout(()=>h(""),5e3)}catch(a){O(a.message)}finally{f(!1)}}},j=async a=>{if(confirm("¿Está seguro de eliminar este presupuesto?"))try{const{error:V}=await c.from("presupuestos").delete().eq("id",a);if(V)throw V;P()}catch(V){console.error("Error al eliminar:",V.message)}},v=async a=>{try{const{data:V,error:p}=await c.from("detalle_presupuestos").select("cantidad, precio_unitario, subtotal_item, producto:productos(codigo_producto, nombre, altura_m, largo_m, separacion_cm)").eq("presupuesto_id",a.id);if(p)throw p;let T=`*PRESUPUESTO ${a.numero_presupuesto}*

`;T+=`📅 Fecha: ${new Date(a.fecha_presupuesto).toLocaleDateString("es-UY")}
`,a.cliente&&(T+=`👤 Cliente: ${a.cliente.nombre}
`),T+=`
*DETALLE DE PRODUCTOS:*
`,T+=`━━━━━━━━━━━━━━━━
`,V==null||V.forEach(te=>{let ce=te.producto?`${te.producto.codigo_producto} - ${te.producto.nombre}`:"Producto";te.producto&&(te.producto.altura_m||te.producto.largo_m||te.producto.separacion_cm)&&(ce+=" (",te.producto.altura_m&&(ce+=`${te.producto.altura_m}m`),te.producto.largo_m&&(ce+=` x ${te.producto.largo_m}m`),te.producto.separacion_cm&&(ce+=` - ${te.producto.separacion_cm}cm`),ce+=")"),T+=`
${ce}
`,T+=`   Cantidad: ${te.cantidad}
`,T+=`   Precio: $${te.precio_unitario.toFixed(2)}
`,T+=`   Subtotal: $${te.subtotal_item.toFixed(2)}
`}),T+=`
━━━━━━━━━━━━━━━━
`,T+=`💰 Subtotal: $${a.subtotal.toFixed(2)}
`,a.descuento>0&&(T+=`🎯 Descuento: -$${a.descuento.toFixed(2)}
`),T+=`
*TOTAL: $${a.total.toFixed(2)}*
`,a.notas&&(T+=`
📝 Notas: ${a.notas}
`);const{data:z}=await c.from("clientes").select("telefono").eq("id",a.cliente_id).maybeSingle(),oe=encodeURIComponent(T);let le="";z!=null&&z.telefono?le=`https://wa.me/${z.telefono.replace(/\D/g,"")}?text=${oe}`:le=`https://wa.me/?text=${oe}`,window.open(le,"_blank")}catch(V){console.error("Error al compartir por WhatsApp:",V.message),O("Error al preparar el mensaje de WhatsApp")}},F=a=>{const V={pendiente:{color:"#f59e0b",bg:"#fef3c7",icon:mr,label:"Pendiente"},aprobado:{color:"#10b981",bg:"#d1fae5",icon:ke,label:"Aprobado"},rechazado:{color:"#ef4444",bg:"#fee2e2",icon:vr,label:"Rechazado"},convertido:{color:"#3b82f6",bg:"#dbeafe",icon:ke,label:"Convertido"}},p=V[a]||V.pendiente,T=p.icon;return e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",padding:"0.25rem 0.75rem",borderRadius:"9999px",fontSize:"0.875rem",fontWeight:"600",color:p.color,backgroundColor:p.bg},children:[e.jsx(T,{size:14}),p.label]})};return D?e.jsx(me,{children:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("div",{className:"loading",children:"Cargando..."})})}):e.jsxs(me,{children:[e.jsx("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"2rem"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsx("div",{style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",padding:"2rem",color:"white"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"700"},children:"Presupuestos"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",opacity:.9},children:"Gestiona las cotizaciones de tus clientes"})]}),e.jsxs("button",{onClick:()=>_("/nuevo-presupuesto"),style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.75rem 1.5rem",backgroundColor:"white",color:"#3b82f6",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:[e.jsx(Ne,{size:20}),"Nuevo Presupuesto"]})]})}),e.jsxs("div",{style:{padding:"2rem"},children:[Q&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:Q})]}),x&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:x})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"1rem",marginBottom:"2rem"},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Ke,{size:20,style:{position:"absolute",left:"12px",top:"50%",transform:"translateY(-50%)",color:"#6b7280"}}),e.jsx("input",{type:"text",placeholder:"Buscar por número o cliente...",value:G,onChange:a=>X(a.target.value),style:{width:"100%",padding:"0.75rem 0.75rem 0.75rem 2.5rem",border:"2px solid #e5e7eb",borderRadius:"8px",fontSize:"1rem"}})]}),e.jsxs("select",{value:M,onChange:a=>y(a.target.value),style:{padding:"0.75rem",border:"2px solid #e5e7eb",borderRadius:"8px",fontSize:"1rem"},children:[e.jsx("option",{value:"todos",children:"Todos los estados"}),e.jsx("option",{value:"pendiente",children:"Pendiente"}),e.jsx("option",{value:"aprobado",children:"Aprobado"}),e.jsx("option",{value:"rechazado",children:"Rechazado"}),e.jsx("option",{value:"convertido",children:"Convertido"})]})]}),R.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"4rem 2rem",color:"#6b7280"},children:[e.jsx(mt,{size:64,style:{margin:"0 auto 1rem",opacity:.3}}),e.jsx("p",{style:{fontSize:"1.25rem",fontWeight:"600"},children:G||M!=="todos"?"No se encontraron presupuestos":"No hay presupuestos registrados"}),e.jsx("p",{style:{marginTop:"0.5rem"},children:G||M!=="todos"?"Intenta con otros filtros":"Comienza creando tu primer presupuesto"})]}):e.jsx("div",{style:{background:"white",borderRadius:"8px",overflow:"hidden",border:"1px solid #e5e7eb"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f8fafc",borderBottom:"2px solid #e5e7eb"},children:[e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:"600"},children:"Número"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:"600"},children:"Fecha"}),e.jsx("th",{style:{padding:"1rem",textAlign:"left",fontWeight:"600"},children:"Cliente"}),e.jsx("th",{style:{padding:"1rem",textAlign:"right",fontWeight:"600"},children:"Total"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontWeight:"600"},children:"Estado"}),e.jsx("th",{style:{padding:"1rem",textAlign:"center",fontWeight:"600"},children:"Acciones"})]})}),e.jsx("tbody",{children:R.map(a=>{var V;return e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"1rem",fontWeight:"600",color:"#3b82f6"},children:a.numero_presupuesto}),e.jsx("td",{style:{padding:"1rem"},children:new Date(a.fecha_presupuesto).toLocaleDateString("es-UY")}),e.jsx("td",{style:{padding:"1rem"},children:((V=a.cliente)==null?void 0:V.nombre)||"Sin cliente"}),e.jsxs("td",{style:{padding:"1rem",textAlign:"right",fontWeight:"600"},children:["$",a.total.toFixed(2)]}),e.jsx("td",{style:{padding:"1rem",textAlign:"center"},children:F(a.estado)}),e.jsx("td",{style:{padding:"1rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"center"},children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),v(a)},style:{padding:"0.5rem",backgroundColor:"#dcfce7",color:"#16a34a",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Compartir por WhatsApp",children:e.jsx(Pt,{size:16})}),a.estado!=="convertido"&&e.jsxs("button",{onClick:()=>ee(a,"aprobado"),style:{padding:"0.5rem 1rem",backgroundColor:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem",display:"flex",alignItems:"center",gap:"0.25rem"},title:"Convertir a venta",children:[e.jsx(ke,{size:14}),"Convertir"]}),a.estado==="pendiente"&&e.jsx("button",{onClick:()=>ee(a,"rechazado"),style:{padding:"0.5rem 1rem",backgroundColor:"#ef4444",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"600",fontSize:"0.875rem"},title:"Rechazar",children:"Rechazar"}),e.jsx("button",{onClick:()=>j(a.id),style:{padding:"0.5rem",backgroundColor:"#fee2e2",color:"#dc2626",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},title:"Eliminar",children:e.jsx(Ee,{size:16})})]})})]},a.id)})})]})})]})]})}),I&&q&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"1rem"},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"12px",padding:"2rem",maxWidth:"800px",width:"100%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{margin:0,fontSize:"1.5rem",fontWeight:"700",color:"#1f2937"},children:"Convertir Presupuesto a Venta"}),e.jsxs("p",{style:{margin:"0.5rem 0 0 0",color:"#6b7280"},children:[q.numero_presupuesto," - $",q.total.toFixed(2)]})]}),e.jsx("button",{type:"button",onClick:()=>{A(!1),u(null)},style:{padding:"4px",display:"flex",alignItems:"center",backgroundColor:"transparent",color:"#6b7280",border:"none",cursor:"pointer"},children:e.jsx(Te,{size:24})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1.5rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Método de Pago *"}),e.jsxs("select",{value:i.metodo_pago,onChange:a=>l({...i,metodo_pago:a.target.value}),style:{width:"100%"},children:[e.jsx("option",{value:"efectivo",children:"Efectivo"}),e.jsx("option",{value:"transferencia",children:"Transferencia"}),e.jsx("option",{value:"tarjeta",children:"Tarjeta"}),e.jsx("option",{value:"mercadopago",children:"MercadoPago"})]})]}),e.jsxs("div",{style:{background:"#f8fafc",padding:"1.5rem",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[e.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1.1rem",fontWeight:"600",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(Et,{size:20}),"Datos de Entrega"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Localidad"}),e.jsx("input",{type:"text",value:i.localidad,onChange:a=>l({...i,localidad:a.target.value}),placeholder:"Ej: Montevideo"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Dirección de Entrega"}),e.jsx("input",{type:"text",value:i.direccion_entrega,onChange:a=>l({...i,direccion_entrega:a.target.value}),placeholder:"Ej: Av. 18 de Julio 1234"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Costo de Delivery (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:i.costo_delivery,onChange:a=>l({...i,costo_delivery:a.target.value}),placeholder:"0.00"})]})]}),e.jsx("div",{style:{marginTop:"1rem"},children:e.jsx(st,{onLocationSelect:(a,V)=>{l({...i,latitud:a,longitud:V})}})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notas Adicionales"}),e.jsx("textarea",{value:i.notas_venta,onChange:a=>l({...i,notas_venta:a.target.value}),rows:3,placeholder:"Notas adicionales para la venta..."})]}),e.jsxs("div",{style:{background:"#eff6ff",padding:"1rem",borderRadius:"8px",border:"1px solid #bfdbfe"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontWeight:"600"},children:"Subtotal Presupuesto:"}),e.jsxs("span",{children:["$",q.subtotal.toFixed(2)]})]}),q.descuento>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontWeight:"600"},children:"Descuento:"}),e.jsxs("span",{children:["-$",q.descuento.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontWeight:"600"},children:"Total Presupuesto:"}),e.jsxs("span",{children:["$",q.total.toFixed(2)]})]}),parseFloat(i.costo_delivery)>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem"},children:[e.jsx("span",{style:{fontWeight:"600"},children:"Costo Delivery:"}),e.jsxs("span",{children:["+$",parseFloat(i.costo_delivery).toFixed(2)]})]}),e.jsx("div",{style:{borderTop:"2px solid #3b82f6",paddingTop:"0.5rem",marginTop:"0.5rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"1.2rem"},children:[e.jsx("span",{style:{fontWeight:"700"},children:"TOTAL VENTA:"}),e.jsxs("span",{style:{fontWeight:"700",color:"#3b82f6"},children:["$",(q.total+parseFloat(i.costo_delivery)).toFixed(2)]})]})})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("button",{type:"button",onClick:H,disabled:k,style:{flex:1,padding:"1rem",backgroundColor:k?"#9ca3af":"#10b981",color:"white",border:"none",borderRadius:"8px",cursor:k?"not-allowed":"pointer",fontWeight:"600",fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(ke,{size:20}),k?"Convirtiendo...":"Convertir a Venta"]}),e.jsx("button",{type:"button",onClick:()=>{A(!1),u(null)},disabled:k,style:{flex:1,padding:"1rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"8px",cursor:k?"not-allowed":"pointer",fontWeight:"600",fontSize:"1rem"},children:"Cancelar"})]})]})]})})]})}function Vr(){const _=rt(),[E,B]=o.useState([]),[R,N]=o.useState([]),[D,w]=o.useState([]),[G,X]=o.useState([]),[M,y]=o.useState([]),[I,A]=o.useState([]),[q,u]=o.useState(!0),[k,f]=o.useState(""),[Q,O]=o.useState(""),[x,h]=o.useState(null),[i,l]=o.useState(!1),[P,W]=o.useState({nombre:"",telefono:"",direccion:""}),[ee,H]=o.useState({cliente_id:"",fecha_presupuesto:new Date().toISOString().split("T")[0],descuento:"",notas:""}),[j,v]=o.useState([]),[F,a]=o.useState({tipo:"producto",promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""});o.useEffect(()=>{V()},[]);const V=async()=>{var s;try{const[Y,d,C,L,Z]=await Promise.all([c.from("clientes").select("*").eq("activo",!0),c.from("productos").select("*").eq("activo",!0),c.from("categorias").select("*").order("nombre"),c.from("promociones").select("*").eq("activo",!0).order("nombre"),c.from("empresas").select("id, nombre, direccion, telefono").limit(1).maybeSingle()]);if(Y.error)throw Y.error;if(d.error)throw d.error;if(C.error)throw C.error;if(L.error)throw L.error;if(Z.error)throw Z.error;B(Y.data||[]),N(d.data||[]),X(C.data||[]),w(L.data||[]),h(((s=Z.data)==null?void 0:s.id)||null)}catch(Y){f(Y.message)}finally{u(!1)}},p=s=>{if(a({tipo:F.tipo,promocion_id:"",categoria_id:s,subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),s){const Y=[...new Set(R.filter(d=>d.categoria_id===s&&d.subtipo).map(d=>d.subtipo))].sort();y(Y)}else y([]);A([])},T=s=>{if(a({...F,subtipo:s,producto_id:"",cantidad:"",precio_unitario:""}),s){const Y=R.filter(d=>d.categoria_id===F.categoria_id&&d.subtipo===s);A(Y)}else A([])},z=async()=>{if(!P.nombre.trim()){f("El nombre del cliente es requerido");return}if(!x){f("No se pudo obtener la empresa");return}try{const{data:s,error:Y}=await c.from("clientes").insert({empresa_id:x,nombre:P.nombre,telefono:P.telefono||null,direccion:P.direccion||null,activo:!0}).select().single();if(Y)throw Y;B([...E,s]),H({...ee,cliente_id:s.id}),W({nombre:"",telefono:"",direccion:""}),l(!1),O("Cliente agregado exitosamente"),setTimeout(()=>O(""),3e3)}catch(s){f(s.message)}},oe=async()=>{if(F.tipo==="promocion"){if(!F.promocion_id){f("Seleccione una promoción");return}try{const{data:s,error:Y}=await c.from("detalle_promociones").select("producto_id, cantidad").eq("promocion_id",F.promocion_id);if(Y)throw Y;if(!s||s.length===0){f("La promoción no tiene productos asociados");return}const d=s.map(C=>{const L=R.find(Z=>Z.id===C.producto_id);if(!L||!L.precio_venta)throw new Error("Producto sin precio de venta");return{producto_id:C.producto_id,cantidad:C.cantidad,precio_unitario:L.precio_venta,subtotal_item:C.cantidad*L.precio_venta}});v([...j,...d]),f("")}catch(s){f(s.message);return}}else{if(!F.producto_id||!F.cantidad){f("Complete todos los campos del detalle");return}const s=R.find(L=>L.id===F.producto_id);if(!s||!s.precio_venta){f("El producto seleccionado no tiene precio de venta");return}const Y=parseFloat(F.cantidad),d=s.precio_venta,C=Y*d;v([...j,{producto_id:F.producto_id,cantidad:Y,precio_unitario:d,subtotal_item:C}])}a({tipo:"producto",promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),y([]),A([]),f("")},le=s=>{v(j.filter((Y,d)=>d!==s))},te=()=>{const s=j.reduce((d,C)=>d+C.subtotal_item,0),Y=parseFloat(ee.descuento)||0;return s-Y},ce=async()=>{if(j.length===0){f("Debe agregar al menos un producto al presupuesto");return}if(!x){f("No se pudo obtener la información de la empresa");return}try{const s=new Date().toISOString().split("T")[0],{data:Y,error:d}=await c.from("presupuestos").select("numero_presupuesto").like("numero_presupuesto",`P-${s}%`).order("numero_presupuesto",{ascending:!1}).limit(1);if(d)throw d;let C=1;if(Y&&Y.length>0){const m=Y[0].numero_presupuesto.split("-");m.length===5&&(C=parseInt(m[4])+1)}const L=`P-${s}-${C.toString().padStart(3,"0")}`,Z=j.reduce((m,r)=>m+r.subtotal_item,0),ae=te(),se={numero_presupuesto:L,empresa_id:x,cliente_id:ee.cliente_id||null,fecha_presupuesto:ee.fecha_presupuesto,subtotal:Z,total:ae,descuento:parseFloat(ee.descuento)||0,notas:ee.notas||null,estado:"pendiente"},{data:be,error:ze}=await c.from("presupuestos").insert([se]).select().single();if(ze)throw ze;const re=j.map(m=>({...m,presupuesto_id:be.id,descuento_item:0})),{error:n}=await c.from("detalle_presupuestos").insert(re);if(n)throw n;O(`Presupuesto guardado exitosamente: ${L}`),setTimeout(()=>{_("/presupuestos")},2e3)}catch(s){f(s.message)}},J=s=>{const Y=R.find(C=>C.id===s);if(!Y)return s;let d=`${Y.codigo_producto} - ${Y.nombre}`;return(Y.altura_m||Y.largo_m||Y.separacion_cm)&&(d+=" (",Y.altura_m&&(d+=`${Y.altura_m}m`),Y.largo_m&&(d+=` x ${Y.largo_m}m`),Y.separacion_cm&&(d+=` - ${Y.separacion_cm}cm`),d+=")"),d};return q?e.jsx(me,{children:e.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:e.jsx("div",{className:"loading",children:"Cargando..."})})}):e.jsx(me,{children:e.jsx("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.1)",overflow:"hidden"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",padding:"2rem",color:"white"},children:[e.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:"700"},children:"Nuevo Presupuesto"}),e.jsx("p",{style:{margin:"0.5rem 0 0 0",opacity:.9},children:"Complete los datos para generar un presupuesto"})]}),e.jsxs("div",{style:{padding:"2rem"},children:[k&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#fee2e2",color:"#991b1b",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(Fe,{size:20}),e.jsx("span",{children:k})]}),Q&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem",background:"#d1fae5",color:"#065f46",borderRadius:"8px",marginBottom:"1.5rem"},children:[e.jsx(ke,{size:20}),e.jsx("span",{children:Q})]}),i&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",borderRadius:"8px",padding:"2rem",maxWidth:"500px",width:"90%",maxHeight:"90vh",overflow:"auto"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.5rem",fontWeight:"600"},children:"Agregar Nuevo Cliente"}),e.jsx("button",{type:"button",onClick:()=>l(!1),style:{padding:"4px",display:"flex",alignItems:"center",backgroundColor:"transparent",color:"#6b7280",border:"none",cursor:"pointer"},children:e.jsx(Te,{size:24})})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Nombre *"}),e.jsx("input",{type:"text",value:P.nombre,onChange:s=>W({...P,nombre:s.target.value}),placeholder:"Nombre del cliente"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Teléfono"}),e.jsx("input",{type:"text",value:P.telefono,onChange:s=>W({...P,telefono:s.target.value}),placeholder:"Teléfono del cliente"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Dirección"}),e.jsx("input",{type:"text",value:P.direccion,onChange:s=>W({...P,direccion:s.target.value}),placeholder:"Dirección del cliente"})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsx("button",{type:"button",onClick:z,style:{flex:1,padding:"0.75rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"600"},children:"Guardar Cliente"}),e.jsx("button",{type:"button",onClick:()=>l(!1),style:{flex:1,padding:"0.75rem",backgroundColor:"#6b7280",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontWeight:"600"},children:"Cancelar"})]})]})]})}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),ce()},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cliente"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("select",{value:ee.cliente_id,onChange:s=>H({...ee,cliente_id:s.target.value}),style:{flex:1},children:[e.jsx("option",{value:"",children:"Sin cliente"}),E.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]}),e.jsx("button",{type:"button",onClick:()=>l(!0),style:{padding:"8px 12px",display:"flex",alignItems:"center",gap:"4px",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},title:"Agregar nuevo cliente",children:e.jsx(At,{size:16})})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Fecha Presupuesto *"}),e.jsx("input",{type:"date",value:ee.fecha_presupuesto,onChange:s=>H({...ee,fecha_presupuesto:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Descuento (UYU)"}),e.jsx("input",{type:"number",step:"0.01",value:ee.descuento,onChange:s=>H({...ee,descuento:s.target.value})})]})]}),e.jsxs("div",{className:"form-group",style:{marginBottom:"2rem"},children:[e.jsx("label",{children:"Notas"}),e.jsx("textarea",{value:ee.notas,onChange:s=>H({...ee,notas:s.target.value}),rows:3,placeholder:"Notas adicionales para el presupuesto..."})]}),e.jsxs("div",{style:{background:"#f8fafc",padding:"2rem",borderRadius:"12px",marginBottom:"2rem"},children:[e.jsx("h3",{style:{margin:"0 0 1.5rem 0",fontSize:"1.25rem",fontWeight:"600"},children:"Productos"}),e.jsxs("div",{style:{marginBottom:"1.5rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:"600"},children:"Tipo de ítem"}),e.jsxs("div",{style:{display:"flex",gap:"2rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",value:"producto",checked:F.tipo==="producto",onChange:s=>a({tipo:s.target.value,promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Producto Individual"})]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[e.jsx("input",{type:"radio",value:"promocion",checked:F.tipo==="promocion",onChange:s=>a({tipo:s.target.value,promocion_id:"",categoria_id:"",subtipo:"",producto_id:"",cantidad:"",precio_unitario:""}),style:{cursor:"pointer"}}),e.jsx("span",{children:"Promoción/Combo"})]})]})]}),F.tipo==="promocion"?e.jsxs("div",{style:{marginBottom:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Seleccionar Promoción"}),e.jsxs("select",{value:F.promocion_id,onChange:s=>a({...F,promocion_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Seleccionar promoción..."}),D.map(s=>e.jsxs("option",{value:s.id,children:[s.nombre," - $",s.precio_total.toFixed(2)]},s.id))]}),F.promocion_id&&e.jsx("small",{style:{color:"#6b7280",fontSize:"0.85rem",marginTop:"0.25rem",display:"block"},children:"Esta promoción agregará todos sus productos automáticamente"})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end",marginTop:"1rem"},children:e.jsxs("button",{type:"button",onClick:oe,style:{width:"100%",padding:"0.75rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(Ne,{size:20}),"Agregar Promoción"]})})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginBottom:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Categoría"}),e.jsxs("select",{value:F.categoria_id,onChange:s=>p(s.target.value),children:[e.jsx("option",{value:"",children:"Seleccionar categoría..."}),G.map(s=>e.jsx("option",{value:s.id,children:s.nombre},s.id))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Subtipo"}),e.jsxs("select",{value:F.subtipo,onChange:s=>T(s.target.value),disabled:!F.categoria_id,children:[e.jsx("option",{value:"",children:"Seleccionar subtipo..."}),M.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Producto"}),e.jsxs("select",{value:F.producto_id,onChange:s=>a({...F,producto_id:s.target.value}),disabled:!F.subtipo,children:[e.jsx("option",{value:"",children:"Seleccionar producto..."}),I.map(s=>{let Y="";s.altura_m&&(Y+=`${s.altura_m}m`),s.largo_m&&(Y+=` x ${s.largo_m}m`),s.separacion_cm&&(Y+=` - ${s.separacion_cm}cm`);const d=s.precio_venta?` - $${Number(s.precio_venta).toFixed(2)}`:"";return e.jsx("option",{value:s.id,children:(Y||"Sin medidas")+d},s.id)})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cantidad"}),e.jsx("input",{type:"number",step:"0.01",value:F.cantidad,onChange:s=>a({...F,cantidad:s.target.value})})]}),e.jsx("div",{style:{display:"flex",alignItems:"flex-end"},children:e.jsxs("button",{type:"button",onClick:oe,style:{width:"100%",padding:"0.75rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[e.jsx(Ne,{size:20}),"Agregar"]})})]})}),j.length>0&&e.jsx("div",{style:{background:"white",borderRadius:"8px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f1f5f9"},children:[e.jsx("th",{style:{padding:"0.75rem",textAlign:"left",fontWeight:"600"},children:"Producto"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"center",fontWeight:"600"},children:"Cantidad"}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Precio Unit."}),e.jsx("th",{style:{padding:"0.75rem",textAlign:"right",fontWeight:"600"},children:"Subtotal"}),e.jsx("th",{style:{padding:"0.75rem",width:"50px"}})]})}),e.jsxs("tbody",{children:[j.map((s,Y)=>e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:J(s.producto_id)}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:s.cantidad}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right"},children:["$",s.precio_unitario.toFixed(2)]}),e.jsxs("td",{style:{padding:"0.75rem",textAlign:"right"},children:["$",s.subtotal_item.toFixed(2)]}),e.jsx("td",{style:{padding:"0.75rem",textAlign:"center"},children:e.jsx("button",{type:"button",onClick:()=>le(Y),style:{padding:"0.5rem",backgroundColor:"#fee2e2",color:"#dc2626",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Ee,{size:16})})})]},Y)),e.jsxs("tr",{style:{background:"#f8fafc",fontWeight:"700",fontSize:"1.1rem"},children:[e.jsx("td",{colSpan:3,style:{padding:"1rem",textAlign:"right"},children:"TOTAL:"}),e.jsxs("td",{colSpan:2,style:{padding:"1rem",textAlign:"right",color:"#3b82f6"},children:["$",te().toFixed(2)]})]})]})]})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>_("/presupuestos"),style:{padding:"0.75rem 1.5rem",backgroundColor:"#e5e7eb",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem"},children:"Cancelar"}),e.jsxs("button",{type:"submit",style:{padding:"0.75rem 2rem",backgroundColor:"#3b82f6",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(mt,{size:20}),"Generar PDF"]})]})]})]})]})})})}function we({children:_}){const{user:E,loading:B}=ut();return B?e.jsx("div",{className:"loading-screen",children:"Cargando..."}):E?e.jsx(e.Fragment,{children:_}):e.jsx(Ct,{to:"/login"})}function qr(){return e.jsx(ir,{children:e.jsx(Ot,{children:e.jsxs(Ht,{children:[e.jsx(Ce,{path:"/login",element:e.jsx(nr,{})}),e.jsx(Ce,{path:"/dashboard",element:e.jsx(we,{children:e.jsx(_r,{})})}),e.jsx(Ce,{path:"/productos",element:e.jsx(we,{children:e.jsx(Cr,{})})}),e.jsx(Ce,{path:"/stock",element:e.jsx(we,{children:e.jsx(Sr,{})})}),e.jsx(Ce,{path:"/ventas",element:e.jsx(we,{children:e.jsx(Nr,{})})}),e.jsx(Ce,{path:"/nueva-venta",element:e.jsx(we,{children:e.jsx(zr,{})})}),e.jsx(Ce,{path:"/rutas",element:e.jsx(we,{children:e.jsx(Ar,{})})}),e.jsx(Ce,{path:"/compras",element:e.jsx(we,{children:e.jsx(Dr,{})})}),e.jsx(Ce,{path:"/gastos",element:e.jsx(we,{children:e.jsx(Ir,{})})}),e.jsx(Ce,{path:"/reportes",element:e.jsx(we,{children:e.jsx(Mr,{})})}),e.jsx(Ce,{path:"/clientes",element:e.jsx(we,{children:e.jsx($r,{})})}),e.jsx(Ce,{path:"/proveedores",element:e.jsx(we,{children:e.jsx(Wr,{})})}),e.jsx(Ce,{path:"/promociones",element:e.jsx(we,{children:e.jsx(Br,{})})}),e.jsx(Ce,{path:"/presupuestos",element:e.jsx(we,{children:e.jsx(Lr,{})})}),e.jsx(Ce,{path:"/nuevo-presupuesto",element:e.jsx(we,{children:e.jsx(Vr,{})})}),e.jsx(Ce,{path:"/",element:e.jsx(Ct,{to:"/dashboard"})})]})})})}dt.createRoot(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(qr,{})}));
